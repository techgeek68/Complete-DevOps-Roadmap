# Web Servers: Apache & Nginx, Hosting, Security, Load Balancing, and Ultra-Enterprise Enhancements

This guide covers installing and configuring Apache and Nginx web servers for hosting static, PHP, and Python websites; securing with HTTPS; SSH login; and setting up Nginx as a load balancer. Includes SELinux, firewall, multi-site/virtual host scenarios, and ultra-enterprise topics for modern DevOps environments.

---

## 1. SSH Login for Remote Server Access

**Linux/Mac:**
```bash
ssh devops@192.168.100.172
```
**Windows:**  
Download & install [MobaXterm](https://mobaxterm.mobatek.net/)  
Start local terminal:
```bash
ssh devops@192.168.100.172
```

---

## 2. Apache Web Server Setup

### A. Install & Start Apache (CentOS/RHEL)
```bash
sudo yum update -y
rpm -q httpd
sudo yum install httpd -y
sudo systemctl start httpd
sudo systemctl enable httpd
```

### B. Open Firewall Ports
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### C. Verify Installation
Visit: `http://<server-IP>`, `http://localhost`, `http://127.0.0.1`  
Check hosts file:  
```bash
cat /etc/hosts
```

---

## 3. Hosting a Static Website

### A. Directory Setup
```bash
sudo mkdir -p /var/www/html
ls -lh /var/www
sudo chown -R apache:apache /var/www/html
ls -lh /var/www
```

### B. Create Pages
```bash
cd /var/www/html
vim index.html
# <h1> This is a static website!!! </h1>

sudo mkdir page1 page2
cd page1 && sudo vim index.html
# <h1> Welcome to page1 </h1>
cd ../page2 && sudo vim index.html
# <h1> Welcome to page2 </h1>
sudo systemctl restart httpd
```
### C. Verify
Visit: `http://127.0.0.1/`, `http://127.0.0.1/page1`, `http://127.0.0.1/page2`

---

## 4. Apache Main Configuration

- Main config: `/etc/httpd/conf/httpd.conf`
  ```
  DocumentRoot "/var/www/html"
  ```

- Custom Virtual Host:
  ```bash
  cd /etc/httpd/conf.d
  vi mywebsite.conf
  ```
  ```
  <VirtualHost *:80>
      ServerName www.mywebsite.com
      ServerAlias www.mywebsite.com
      DocumentRoot /var/www/html/mywebsite
  </VirtualHost>
  ```
  ```bash
  httpd -t
  systemctl restart httpd
  ```

---

## 5. Multiple Websites with Virtual Hosts

### A. Directory Structure
```bash
cd /var/www
sudo mkdir -p example1.com/public_html
sudo mkdir -p example2.com/public_html
sudo chown -R apache:apache example1.com/public_html
sudo chown -R apache:apache example2.com/public_html
sudo chmod -R 755 /var/www
```

### B. Sample Pages
Place `index.html` in both `public_html` directories.

### C. Virtual Host Configs
- `example1.com.conf`:
  ```
  <VirtualHost *:80>
      ServerAdmin admin@example1.com
      ServerName example1.com
      ServerAlias www.example1.com
      DocumentRoot /var/www/example1.com/public_html
  </VirtualHost>
  ```
- `example2.com.conf`:
  ```
  <VirtualHost *:80>
      ServerAdmin admin@example2.com
      ServerName example2.com
      ServerAlias www.example2.com
      DocumentRoot /var/www/example2.com/public_html
  </VirtualHost>
  ```
```bash
sudo apachectl configtest
sudo systemctl restart httpd
```
### D. Local Testing
Edit `/etc/hosts` on your local machine:
```
SERVER_IP example1.com
SERVER_IP example2.com
```

---

## 6. Hosting PHP Websites

### A. Install Apache & PHP
```bash
sudo dnf update -y
sudo dnf install httpd -y
sudo dnf install php -y
sudo systemctl start httpd
sudo systemctl enable httpd
php -v
```
### B. Firewall
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```
### C. Directory & Permissions
```bash
sudo mkdir -p /var/www/phpwebsite
sudo chown -R apache:apache /var/www/phpwebsite
sudo chmod -R 755 /var/www
```
### D. Virtual Host Config
`/etc/httpd/conf.d/phpwebsite.conf`:
```
<VirtualHost *:80>
    ServerAdmin admin@phpwebsite
    ServerName phpwebsite
    ServerAlias www.phpwebsite
    DocumentRoot /var/www/phpwebsite
    <FilesMatch \.php$>
      SetHandler "proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"
    </FilesMatch>
</VirtualHost>
```
### E. PHP-FPM
```bash
sudo vi /var/www/phpwebsite/index.php
# <?php phpinfo(); ?>
sudo systemctl restart httpd
sudo systemctl start php-fpm
sudo systemctl enable php-fpm
sudo apachectl configtest
sudo systemctl restart httpd
```
Test: `http://127.0.0.1/`

---

## 7. Hosting Python Websites (mod_wsgi)

### A. Install Apache, Python, mod_wsgi
```bash
sudo dnf update -y
sudo dnf install httpd python3 python3-mod_wsgi -y
sudo systemctl start httpd
sudo systemctl enable httpd
```
### B. Firewall
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```
### C. Directory & Permissions
```bash
cd /var/www
sudo mkdir python
cd python
sudo vim myweb.py
# Python WSGI application code
sudo chown -R apache:apache /var/www/python
sudo chmod -R 755 /var/www
```
### D. Virtual Host Config
`/etc/httpd/conf.d/python.conf`:
```
<VirtualHost *:80>
    ServerAdmin admin@python
    ServerName python
    ServerAlias www.python.com
    WSGIScriptAlias / /var/www/python/myweb.py
</VirtualHost>
```
### E. Restart & Test
```bash
sudo systemctl restart httpd
sudo apachectl configtest
```
Test: `http://127.0.0.1/`

---

## 8. Hosting a Secure Site (HTTPS/SSL with Apache)

### A. Install SSL Packages
```bash
rpm -q httpd mod_ssl openssl
dnf -y install mod_ssl openssl httpd
```
### B. Firewall
```bash
firewall-cmd --list-all
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
firewall-cmd --list-all
```
### C. SSL Configuration
Edit `/etc/httpd/conf.d/ssl.conf`:
```
SSLCertificateFile /etc/pki/tls/certs/localhost.crt
SSLCertificateKeyFile /etc/pki/tsl/private/localhost.key
```
### D. Self-signed Certificate
```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -out /etc/pki/tls/certs/localhost.crt -keyout /etc/pki/tls/private/localhost.key
```
### E. DocumentRoot/Permissions
```bash
sudo mkdir -p /var/www/devopsclass
sudo chown apache:apache /var/www/devopsclass
sudo chmod 755 /var/www/devopsclass
cd /var/www/devopsclass
vim index.html
# <h1> testing secure site!! </h1>
```
### F. Virtual Host for HTTPS
`/etc/httpd/conf.d/devopsclass.conf`:
```
<VirtualHost *:443>
    ServerName www.devopsclass.com
    DocumentRoot /var/www/devopsclass
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
</VirtualHost>
```
### G. Restart & Test
```bash
httpd -t
systemctl restart httpd
```
Test: `https://127.0.0.1/`  
(Proceed past the browser warning for self-signed certificate)

---

## 9. Nginx Web Server Setup

### A. Remove/Stop Apache (if needed)
```bash
dnf -y remove httpd
systemctl stop httpd
systemctl disable httpd
```
### B. Install & Start Nginx
```bash
dnf -y install nginx
systemctl start nginx
systemctl enable nginx
```
### C. Firewall
```bash
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```
### D. Default Page & Config
```bash
cd /usr/share/nginx/html
sudo mkdir devops
cd devops
sudo vim index.html
# <h1> Testing nginx Web Server </h1>
cd /etc/nginx/conf.d
sudo vim devops.conf
# server {
#   listen 80;
#   server_name 192.168.64.4; # or www.devops.com
#   root /usr/share/nginx/html/devops;
#   index index.html;
# }
sudo nginx -t
sudo systemctl restart nginx
```
Test: `http://127.0.0.1/`

---

## 10. Load Balancer Setup Using Nginx

### A. Architecture
- 3 VMs: Load Balancer (192.168.64.5), Node 1 (192.168.64.6), Node 2 (192.168.64.7)

### B. Configure Load Balancer
```bash
hostnamectl set-hostname loadbalancer
dnf -y install nginx
systemctl start nginx
systemctl enable nginx
firewall-cmd --permanent --add-service=http
firewall-cmd --reload
cd /etc/nginx/conf.d
sudo vim loadbalance.conf
```
```
upstream backend_servers {
    server 192.168.64.6;
    server 192.168.64.7;
}
server {
    listen 80;
    server_name 192.168.64.5;
    location / {
        proxy_pass http://backend_servers;
    }
}
```
Test & restart:
```bash
sudo nginx -t
sudo systemctl restart nginx
```

### C. Configure Backend Servers (Node 1 & Node 2)
- Install & start nginx, open firewall, create `devops/index.html` in `/usr/share/nginx/html`
- Node1: `server_name 10.10.5.6`
- Node2: `server_name 10.10.5.7`
- Update `/etc/nginx/conf.d/node1.conf` and `/etc/nginx/conf.d/node2.conf` for each node.

---

## 11. SELinux and Security

- Check SELinux status:
  ```bash
  getenforce
  ```
- View logs:
  ```bash
  sudo cat /var/log/audit/audit.log | grep nginx
  ```
- List and set booleans:
  ```bash
  getsebool -a
  getsebool -a | grep network
  setsebool -P httpd_can_network_connect=1
  getsebool -a | grep httpd_can_network_connect
  ```

---

## 12. Ultra-Enterprise Enhancements

### A. Advanced Application-Level Monitoring (APM)
- Integrate tools like **New Relic**, **Datadog APM**, **Elastic APM** for real-time web transaction tracing, error detection, and performance analytics.
- Instrument web apps for latency, throughput, slow queries, distributed tracing, and user experience.

### B. Automated Certificate Management (Let's Encrypt, Certbot)
- Use **Certbot** for free SSL/TLS certificates and auto-renewal:
  ```bash
  sudo dnf install certbot python3-certbot-apache
  sudo certbot --apache
  # For Nginx:
  sudo dnf install certbot python3-certbot-nginx
  sudo certbot --nginx
  # Schedule renewal:
  echo "0 0 * * * certbot renew --quiet" | sudo tee /etc/cron.d/certbot-renew
  ```
- Integrate certificate lifecycle management with monitoring and alerting.

### C. Infrastructure as Code (IaC)
- Use **Terraform** and **Ansible** for automated, repeatable deployments of web servers, load balancers, firewalls, certificates, and DNS.
- Example: Terraform for AWS EC2 + Ansible for Apache setup.
- Store configurations in version control and integrate with CI/CD for automated provisioning and rollback.

### D. Containerized Web Servers (Docker, Kubernetes Ingress)
- Deploy web servers as Docker containers for portability and scalability:
  - Example:  
    ```bash
    docker run -d -p 80:80 --name webserver -v /site:/usr/share/nginx/html nginx
    ```
- Use **Kubernetes** with **Ingress controllers** for scalable, self-healing deployments, SSL termination, and advanced routing.
- Define web apps and load balancers in YAML manifests and manage with `kubectl`.

### E. CI/CD Integration for Automated Updates
- Connect GitHub/GitLab CI/CD pipelines to build, test, and deploy web server updates automatically.
- Example:  
  - Push to main branch triggers Ansible playbook or Docker build/deploy.
  - Use pipeline stages for syntax check (`nginx -t`, `httpd -t`), unit/integration tests, and production rollout.

### F. Web Application Firewall (WAF) Configuration
- Deploy WAFs (e.g., **ModSecurity** for Apache/Nginx, AWS WAF, Cloudflare WAF) to block attacks (SQL injection, XSS, etc).
- Configure security rules, monitor logs, and integrate with SIEM for threat detection.
- Example for ModSecurity with Apache:
  ```bash
  sudo dnf install mod_security
  sudo systemctl restart httpd
  ```
- For Nginx: Use open source WAF modules or integrate with cloud WAF services.

---

## References

- `man httpd`, `man nginx`, `man firewall-cmd`, `man openssl`, `man docker`, `man kubectl`
- [Apache HTTP Server Docs](https://httpd.apache.org/docs/)
- [Nginx Docs](https://nginx.org/en/docs/)
- [Let’s Encrypt Certbot](https://certbot.eff.org/)
- [Terraform](https://www.terraform.io/docs/)
- [Ansible](https://docs.ansible.com/)
- [New Relic APM](https://docs.newrelic.com/docs/apm/)
- [Datadog APM](https://docs.datadoghq.com/apm/)
- [Elastic APM](https://www.elastic.co/guide/en/apm/get-started/current/overview.html)
- [Docker Docs](https://docs.docker.com/)
- [Kubernetes Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/)
- [GitHub Actions](https://docs.github.com/en/actions)
- [GitLab CI/CD](https://docs.gitlab.com/ee/ci/)
- [ModSecurity](https://modsecurity.org/)
- [AWS WAF](https://docs.aws.amazon.com/waf/latest/developerguide/)
- [Cloudflare WAF](https://developers.cloudflare.com/waf/)

---

_Best Practice:_  
Use infrastructure as code, automate everything (certificates, deployments, updates), monitor at all levels (APM, server, security), containerize for scale, protect with WAF, and integrate with CI/CD for continuous delivery. This is the modern DevOps standard for web services.

---
