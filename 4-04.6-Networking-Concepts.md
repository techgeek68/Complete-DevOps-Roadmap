# Configuring Networking (Linux Focus)

---
- Configuring network interfaces (ifconfig, ip commands).
- Configuring DNS, IP addresses, subnet masks, and gateways.
- Network troubleshooting with ping, traceroute, netstat, ss, and curl.
- Network troubleshooting and adjusting firewall rules using iptables or firewalld.
---

## 9.1 Core Concepts

### IP Address
A unique numerical label assigned to every device participating in an IP network for identification and routing.

Types:
- IPv4: 32-bit, dotted decimal (e.g., `192.168.1.1`)
- IPv6: 128-bit, hexadecimal (e.g., `2001:0db8:85a3::8a2e:0370:7334`)

Functions:
- Identifies a host or interface
- Enables routing of packets to the correct destination

Categories:
- Public IP: Globally routable (allocated by IANA/RIRs → ISP)
- Private IP: RFC 1918 ranges used inside local networks (NAT required for public access)
  - 10.0.0.0/8
  - 172.16.0.0/12
  - 192.168.0.0/16

### Default Gateway
A router that forwards traffic destined for remote networks (e.g., LAN → Internet). Often performs NAT for private→public translation.

### DNS (Domain Name System)
Resolves human-readable names (e.g., `example.com`) to IP addresses. Reduces need to memorize IPs.

Types of DNS servers:
- Recursive resolver: Performs iterative lookups on behalf of client (e.g., 8.8.8.8)
- Authoritative nameserver: Holds original zone records

---

## 9.2 IPv4 Classful Overview & Special Ranges (Historical Context)

Although modern networking uses CIDR (classless), understanding historical classes helps interpret legacy documentation.

| Class | First Octet Range | Historical Public Range | Private Range (RFC1918) | Default Mask | CIDR Example | Notable Reserved / Special |
|-------|-------------------|-------------------------|--------------------------|--------------|--------------|----------------------------|
| A | 1–126 | 1.0.0.0 – 126.255.255.255 | 10.0.0.0 – 10.255.255.255 | 255.0.0.0 | /8 | 127.0.0.0/8 loopback |
| B | 128–191 | 128.0.0.0 – 191.255.255.255 | 172.16.0.0 – 172.31.255.255 | 255.255.0.0 | /16 | 169.254.0.0/16 APIPA |
| C | 192–223 | 192.0.0.0 – 223.255.255.255 | 192.168.0.0 – 192.168.255.255 | 255.255.255.0 | /24 | 192.0.2.0/24 TEST-NET (doc) |
| D | 224–239 | 224.0.0.0 – 239.255.255.255 | N/A | N/A | /4 | Multicast (e.g., 224.0.0.1 all hosts LAN) |
| E | 240–255 | 240.0.0.0 – 255.255.255.254 | N/A | N/A | Experimental | 255.255.255.255 limited broadcast |

Additional Documentation/Test Ranges:
- 198.51.100.0/24, 203.0.113.0/24 (documentation use)
- 100.64.0.0/10 (Carrier Grade NAT)
- 224.0.0.0/4 (Multicast)
- 255.255.255.255 (Local broadcast)

---

## 9.3 Quick Reference Commands

| Purpose | Command(s) | Notes |
|---------|------------|-------|
| Show host IPs | `hostname -I` | Space-separated; Linux-specific |
| Show interfaces (legacy) | `ifconfig` | Deprecated; use `ip` |
| Show interfaces (modern) | `ip addr show` | `ip a` shorthand |
| Bring interface up/down | `ip link set eth0 up` / `ip link set eth0 down` | Replace `eth0` with actual name |
| Add IPv4 addr | `ip addr add 192.168.1.100/24 dev eth0` | Use CIDR |
| Show routes | `ip route show` | Modern replacement for `route -n` |
| Show gateway (legacy) | `route -n` | Avoid in new scripts |
| Show DNS servers | `cat /etc/resolv.conf` | May be managed dynamically |
| Show listening sockets (legacy) | `netstat -tulnp` | part of net-tools |
| Show listening sockets (modern) | `ss -tulnp` | Faster; in iproute2 |
| Test reachability | `ping 8.8.8.8` | Control-C to stop |
| Trace path | `traceroute example.com` or `tracepath` | `tracepath` may not need root |
| Test HTTP headers | `curl -I http://example.com` | Use `-v` for verbose |
| DNS resolution test | `dig example.com A` | `dig` from `bind-utils` |
| Flush DNS cache (systemd-resolved) | `systemd-resolve --flush-caches` | Env-specific |

---

## 9.4 Network Interface Configuration

### Using `ifconfig` (Legacy)
```bash
ifconfig                 # List interfaces
ifconfig eth0 up         # Bring interface up
ifconfig eth0 down       # Bring interface down
ifconfig eth0 192.168.1.100 netmask 255.255.255.0
```
Avoid in new automation; present for legacy systems.

### Using `ip` (Preferred)
```bash
ip link set eth0 up
ip addr add 192.168.1.100/24 dev eth0
ip addr del 192.168.1.100/24 dev eth0
ip -br addr                # Brief summary
```

Persisting changes typically involves distro network config (NetworkManager, systemd-networkd, netplan, etc.), not just `ip` commands.

---

## 9.5 Configuring IP, Gateway, DNS

### Via NetworkManager CLI (`nmcli`)
```bash
nmcli connection show
nmcli connection modify eth0 ipv4.addresses "192.168.1.100/24"
nmcli connection modify eth0 ipv4.gateway "192.168.1.1"
nmcli connection modify eth0 ipv4.dns "8.8.8.8 8.8.4.4"
nmcli connection modify eth0 ipv4.method manual
nmcli connection up eth0
```

### Legacy Static Configuration (Older CentOS / RHEL with network-scripts)
File: `/etc/sysconfig/network-scripts/ifcfg-eth0`
```ini
DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=8.8.8.8
DNS2=8.8.4.4
```
Restart network service (older systems): `systemctl restart network` or `service network restart`

### NetworkManager Keyfile Example (CentOS Stream 9+)
Path: `/etc/NetworkManager/system-connections/static-enp.nmconnection`
```ini
[connection]
id=static-enp
uuid=45882b4c-314c-11f0-bb1a-5254000dc1ee
type=ethernet
interface-name=enp0s1
autoconnect=true

[ipv4]
method=manual
addresses=192.168.100.199/24;
gateway=192.168.100.1
dns=192.168.100.1

[ipv6]
method=ignore
```
Apply:
```bash
nmcli connection reload
nmcli connection show
nmcli connection up static-enp
ip addr show enp0s1
```

---

## 9.6 DNS Details

View resolvers:
```bash
cat /etc/resolv.conf
```

Common entries:
```
nameserver 8.8.8.8
nameserver 8.8.4.4
```

Note: On systems using `systemd-resolved`, `/etc/resolv.conf` may be a symlink to `run/systemd/...`. Use:
```bash
resolvectl status
```

---

## 9.7 Routing & Gateway

Show route table:
```bash
ip route show
# Default route example:
# default via 192.168.1.1 dev eth0 proto dhcp metric 100
```

Add default route (temporary):
```bash
ip route add default via 192.168.1.1 dev eth0
```

Delete default route:
```bash
ip route del default
```

---

## 9.8 Troubleshooting Matrix

| Symptom | Diagnostic Steps | Possible Cause | Resolution |
|---------|------------------|----------------|------------|
| No connectivity (ping fails) | `ip addr`, `ip link`, `ping gateway` | Interface down | `ip link set <iface> up` |
| DNS fails, IP works | `ping 8.8.8.8` works; `ping example.com` fails | DNS misconfig | Update `/etc/resolv.conf` or NM settings |
| Cannot reach outside subnet | `ip route show` | Missing default route | Add gateway route |
| Slow resolution | `dig +trace example.com` | DNS server latency | Change to faster resolver |
| Port unreachable | `ss -tulnp`, firewall rules | Service not listening / blocked | Start service or adjust firewall |
| Random IP after boot | `ip addr` shows 169.254.x.x | DHCP failure (APIPA) | Check DHCP server / switch cabling |
| Duplicate IP conflict | ARP logs / `arping` | Misconfigured static IP | Assign unique address |

---

## 9.9 Firewall Management

Two major paradigms:
- `firewalld` (dynamic, zones; uses nftables backend on modern systems)
- `iptables` (legacy; now often a compatibility layer)

### firewalld (Preferred)

List current zone & rules:
```bash
firewall-cmd --state
firewall-cmd --get-active-zones
firewall-cmd --list-all
```

Open HTTP (port 80) permanently:
```bash
firewall-cmd --zone=public --add-port=80/tcp --permanent
firewall-cmd --reload
firewall-cmd --list-ports
```

Services concept (predefined):
```bash
firewall-cmd --get-services
firewall-cmd --add-service=https --permanent
firewall-cmd --reload
```

Enable at boot:
```bash
systemctl enable firewalld --now
```

### iptables (Legacy Example)
List rules:
```bash
iptables -L -n -v
```

Allow inbound HTTP:
```bash
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
```

Persist (CentOS/RHEL with iptables-services):
```bash
service iptables save
systemctl enable iptables --now
```

(Modern alternative: migrate to nftables / firewalld.)

---

## 9.10 Practical Command Cheat Sheet

```bash
# Show brief interface summary
ip -br a

# Assign temporary IPv4
ip addr add 10.10.5.25/24 dev eth0

# Remove that address
ip addr del 10.10.5.25/24 dev eth0

# Show default route
ip route | grep default

# Set DNS (NetworkManager)
nmcli connection modify eth0 ipv4.dns "1.1.1.1 8.8.8.8"

# Test outward path
traceroute 8.8.8.8

# Inspect open listening TCP ports
ss -tlnp

# HTTP header retrieval
curl -I https://example.com

# Quick DNS A record lookup
dig +short example.com

# Show firewall active ports (firewalld)
firewall-cmd --list-ports
```

---

## 9.11 Example Scenario: Static Configuration & Verification

1. Discover interface name:
   ```bash
   ip -br link
   ```
2. Assign static IP via NetworkManager:
   ```bash
   nmcli connection modify eth0 ipv4.addresses "192.168.50.10/24"
   nmcli connection modify eth0 ipv4.gateway "192.168.50.1"
   nmcli connection modify eth0 ipv4.dns "192.168.50.1 1.1.1.1"
   nmcli connection modify eth0 ipv4.method manual
   nmcli connection up eth0
   ```
3. Validate:
   ```bash
   ip addr show eth0
   ip route show
   ping -c 3 192.168.50.1
   dig +short example.com
   curl -I https://example.com
   ```

---

## 9.12 Security & Best Practices

| Area | Recommendation |
|------|---------------|
| Interface Naming | Use predictable names (e.g., `enp0s1`) rather than assuming `eth0` |
| Automation | Templates / IaC (e.g., cloud-init, Ansible) for reproducible networking state |
| Firewalls | Default deny inbound; explicitly allow required service ports |
| DNS | Prefer redundant resolvers; monitor query latency |
| IPv6 | Do not disable blindly; secure with proper firewall rules |
| Logging | Log dropped packets (rate-limited) for forensic value |
| Ephemeral Changes | Avoid manual `ip` changes without persisting if required across reboots |
| NAT Awareness | Document translation points (firewalls/routers) for troubleshooting latency/reachability issues |

---

## 9.13 Legacy vs Modern Summary

| Function | Legacy Tool(s) | Modern Preferred |
|----------|----------------|------------------|
| Interface management | `ifconfig` | `ip addr`, `ip link` |
| Routes | `route` | `ip route` |
| Sockets | `netstat` | `ss` |
| Firewall | `iptables` | `firewalld` (nftables) |
| DNS Query | `nslookup` | `dig`, `getent hosts` |

---

## 9.14 Cleanup & Reversion

If you added a temporary IP:
```bash
ip addr del 192.168.1.100/24 dev eth0
```

If you opened a firewall port (firewalld) for testing:
```bash
firewall-cmd --zone=public --remove-port=8080/tcp --permanent
firewall-cmd --reload
```

If you modified a NetworkManager connection incorrectly:
```bash
nmcli connection reload
nmcli connection modify eth0 ipv4.method auto
nmcli connection up eth0
```

---

## 9.15 Quick Verification

| Check | Command | Expected |
|-------|---------|----------|
| Interface up | `ip link show eth0` | `state UP` |
| IP assigned | `ip -4 addr show eth0` | Correct CIDR present |
| Gateway reachable | `ping -c 2 <gateway>` | Replies |
| External reachability | `ping -c 2 8.8.8.8` | Replies |
| DNS resolution | `dig +short example.com` | Returns IP(s) |
| Firewall not blocking | `ss -tulnp` / `firewall-cmd --list-all` | Port allowed if service required |

---

## 9.17 References (Suggested Further Study)

- RFC 1918 – Address Allocation for Private Internets
- RFC 5735 / 6890 – Special Use IPv4 Addresses
- `man ip`, `man nmcli`, `man firewalld.richlanguage`
- Linux Advanced Routing & Traffic Control HOWTO
---
