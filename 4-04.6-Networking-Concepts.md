# 9. Configuring Networking (Linux Focus)

This section provides a comprehensive reference for DevOps engineers on Linux networking, including interface setup, IP addressing, DNS, routing, troubleshooting, firewall integration, cloud networking (AWS, Azure, GCP), automation, and best practices. All commands are grouped by tool, include verification steps, explanations, cloud scenarios, and recommended practices.

---

## 9.1 Core Concepts

### IP Address
A unique numerical label assigned to every device on an IP network for identification and routing.

Types:
- **IPv4:** 32-bit, dotted decimal (e.g., `192.168.1.1`)
- **IPv6:** 128-bit, hexadecimal (e.g., `2001:0db8:85a3::8a2e:0370:7334`)

Functions:
- Identifies a host or interface
- Enables routing of packets to the correct destination

Categories:
- **Public IP:** Globally routable (allocated by IANA/RIRs → ISP)
- **Private IP:** RFC 1918 ranges used inside local networks (NAT required for public access)
  - 10.0.0.0/8
  - 172.16.0.0/12
  - 192.168.0.0/16

### Default Gateway
A router that forwards traffic destined for remote networks (e.g., LAN → Internet). Often performs NAT for private→public translation.

### DNS (Domain Name System)
Resolves human-readable names (e.g., `example.com`) to IP addresses.

Types:
- Recursive resolver: Performs iterative lookups (e.g., 8.8.8.8)
- Authoritative nameserver: Holds original zone records

_Best Practice:_  
Always document assigned IPs, gateways, and DNS for each host. Use private IP ranges for internal networks and public IPs only when required.

---

## 9.2 IPv4 Classful Overview & Special Ranges

Although modern networking uses CIDR (classless), knowing historical classes helps interpret legacy documentation.

| Class | First Octet Range | Historical Public Range | Private Range (RFC1918) | Default Mask | CIDR Example | Notable Reserved / Special |
|-------|-------------------|-------------------------|--------------------------|--------------|--------------|----------------------------|
| A | 1–126 | 1.0.0.0 – 126.255.255.255 | 10.0.0.0 – 10.255.255.255 | 255.0.0.0 | /8 | 127.0.0.0/8 loopback |
| B | 128–191 | 128.0.0.0 – 191.255.255.255 | 172.16.0.0 – 172.31.255.255 | 255.255.0.0 | /16 | 169.254.0.0/16 APIPA |
| C | 192–223 | 192.0.0.0 – 223.255.255.255 | 192.168.0.0 – 192.168.255.255 | 255.255.255.0 | /24 | 192.0.2.0/24 TEST-NET |
| D | 224–239 | 224.0.0.0 – 239.255.255.255 | N/A | N/A | /4 | Multicast (e.g., 224.0.0.1 all hosts LAN) |
| E | 240–255 | 240.0.0.0 – 255.255.255.254 | N/A | N/A | Experimental | 255.255.255.255 limited broadcast |

Other reserved ranges:
- 198.51.100.0/24, 203.0.113.0/24 (documentation)
- 100.64.0.0/10 (Carrier Grade NAT)
- 255.255.255.255 (Local broadcast)

---

## 9.3 Quick Reference Commands

| Purpose | Command(s) | Notes |
|---------|------------|-------|
| Show host IPs | `hostname -I` | Linux only |
| Show interfaces (legacy) | `ifconfig` | Deprecated; use `ip` |
| Show interfaces (modern) | `ip addr show` | `ip a` shorthand |
| Bring interface up/down | `ip link set eth0 up` / `ip link set eth0 down` | Replace `eth0` as needed |
| Add IPv4 addr | `ip addr add 192.168.1.100/24 dev eth0` | Use CIDR notation |
| Show routes | `ip route show` | Modern replacement for `route -n` |
| Show gateway (legacy) | `route -n` | Avoid in new scripts |
| Show DNS servers | `cat /etc/resolv.conf` | May be managed dynamically |
| Show listening sockets (legacy) | `netstat -tulnp` | part of net-tools |
| Show listening sockets (modern) | `ss -tulnp` | Faster; in iproute2 |
| Test reachability | `ping 8.8.8.8` | Control-C to stop |
| Trace path | `traceroute example.com` or `tracepath` | Use `tracepath` for rootless |
| Test HTTP headers | `curl -I http://example.com` | Use `-v` for verbose |
| DNS resolution test | `dig example.com A` | `dig` from `bind-utils` |
| Flush DNS cache (systemd-resolved) | `systemd-resolve --flush-caches` | Env-specific |

---

## 9.4 Network Interface Configuration

### Using `ifconfig` (Legacy)
```bash
ifconfig                 # List interfaces
ifconfig eth0 up         # Bring interface up
ifconfig eth0 down       # Bring interface down
ifconfig eth0 192.168.1.100 netmask 255.255.255.0
```
_Avoid in new automation; present for legacy systems._

### Using `ip` (Preferred)
```bash
ip link set eth0 up
ip addr add 192.168.1.100/24 dev eth0
ip addr del 192.168.1.100/24 dev eth0
ip -br addr                # Brief summary
```
_Persisting changes typically involves distro network config (NetworkManager, systemd-networkd, netplan, etc.), not just `ip` commands._

_Best Practice:_  
Always use `ip` for scripting and automation unless supporting legacy systems.

---

## 9.5 Configuring IP, Gateway, DNS

### Via NetworkManager CLI (`nmcli`)
```bash
nmcli connection show
nmcli connection modify eth0 ipv4.addresses "192.168.1.100/24"
nmcli connection modify eth0 ipv4.gateway "192.168.1.1"
nmcli connection modify eth0 ipv4.dns "8.8.8.8 8.8.4.4"
nmcli connection modify eth0 ipv4.method manual
nmcli connection up eth0
```

### Legacy Static Configuration (Older CentOS / RHEL with network-scripts)
File: `/etc/sysconfig/network-scripts/ifcfg-eth0`
```ini
DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=8.8.8.8
DNS2=8.8.4.4
```
Restart network service (older systems): `systemctl restart network` or `service network restart`

### NetworkManager Keyfile Example (CentOS Stream 9+)
Path: `/etc/NetworkManager/system-connections/static-enp.nmconnection`
```ini
[connection]
id=static-enp
uuid=45882b4c-314c-11f0-bb1a-5254000dc1ee
type=ethernet
interface-name=enp0s1
autoconnect=true

[ipv4]
method=manual
addresses=192.168.100.199/24;
gateway=192.168.100.1
dns=192.168.100.1

[ipv6]
method=ignore
```
Apply:
```bash
nmcli connection reload
nmcli connection show
nmcli connection up static-enp
ip addr show enp0s1
```

_Best Practice:_  
Store network config in version control for reproducibility. Always reload and verify after changes.

---

## 9.6 DNS Details

View resolvers:
```bash
cat /etc/resolv.conf
```

Common entries:
```
nameserver 8.8.8.8
nameserver 8.8.4.4
```

Note: On systems using `systemd-resolved`, `/etc/resolv.conf` may be a symlink to `run/systemd/...`. Use:
```bash
resolvectl status
```

_Best Practice:_  
Use multiple DNS resolvers for redundancy. Monitor DNS query latency.

---

## 9.7 Routing & Gateway

Show route table:
```bash
ip route show
# Default route example:
# default via 192.168.1.1 dev eth0 proto dhcp metric 100
```

Add default route (temporary):
```bash
ip route add default via 192.168.1.1 dev eth0
```

Delete default route:
```bash
ip route del default
```

_Best Practice:_  
Ensure only one default gateway per host unless multi-homing is intentional.

---

## 9.8 Troubleshooting Matrix

| Symptom | Diagnostic Steps | Possible Cause | Resolution |
|---------|------------------|----------------|------------|
| No connectivity (ping fails) | `ip addr`, `ip link`, `ping gateway` | Interface down | `ip link set <iface> up` |
| DNS fails, IP works | `ping 8.8.8.8` works; `ping example.com` fails | DNS misconfig | Update `/etc/resolv.conf` or NM settings |
| Cannot reach outside subnet | `ip route show` | Missing default route | Add gateway route |
| Slow resolution | `dig +trace example.com` | DNS server latency | Change to faster resolver |
| Port unreachable | `ss -tulnp`, firewall rules | Service not listening / blocked | Start service or adjust firewall |
| Random IP after boot | `ip addr` shows 169.254.x.x | DHCP failure (APIPA) | Check DHCP server / switch cabling |
| Duplicate IP conflict | ARP logs / `arping` | Misconfigured static IP | Assign unique address |

_Best Practice:_  
Log all troubleshooting steps for team review and faster future resolution.

---

## 9.9 Firewall Management

Two major paradigms:
- **firewalld** (dynamic, zones; uses nftables backend on modern systems)
- **iptables** (legacy; now often a compatibility layer)

### firewalld (Preferred)

List current zone & rules:
```bash
firewall-cmd --state
firewall-cmd --get-active-zones
firewall-cmd --list-all
```

Open HTTP (port 80) permanently:
```bash
firewall-cmd --zone=public --add-port=80/tcp --permanent
firewall-cmd --reload
firewall-cmd --list-ports
```

Services concept (predefined):
```bash
firewall-cmd --get-services
firewall-cmd --add-service=https --permanent
firewall-cmd --reload
```

Enable at boot:
```bash
systemctl enable firewalld --now
```

### iptables (Legacy Example)
List rules:
```bash
iptables -L -n -v
```

Allow inbound HTTP:
```bash
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
```

Persist (CentOS/RHEL with iptables-services):
```bash
service iptables save
systemctl enable iptables --now
```

(Modern alternative: migrate to nftables / firewalld.)

_Best Practice:_  
Default deny inbound, only allow required services. Document every rule change.

---

## 9.10 Cloud Networking Basics (AWS, Azure, GCP)

### AWS VPC & Security Groups

**VPC Creation & Subnetting:**
```bash
aws ec2 create-vpc --cidr-block 10.0.0.0/16
aws ec2 create-subnet --vpc-id vpc-1234abcd --cidr-block 10.0.1.0/24
```

**Security Group Rules:**
```bash
aws ec2 describe-security-groups
aws ec2 authorize-security-group-ingress --group-id sg-12345678 --protocol tcp --port 22 --cidr 203.0.113.0/24
aws ec2 revoke-security-group-ingress --group-id sg-12345678 --protocol tcp --port 22 --cidr 0.0.0.0/0
```
_Verification:_  
- Use AWS Console or CLI to confirm rules.

_Best Practice:_  
Restrict security group rules by CIDR. Avoid wide-open (0.0.0.0/0) unless required for testing.

---

### Azure Networking & Network Security Groups (NSG)

**Create NSG Rule:**
```bash
az network nsg rule create \
  --resource-group myResourceGroup \
  --nsg-name myNSG \
  --name AllowSSH \
  --protocol tcp \
  --direction inbound \
  --priority 1000 \
  --source-address-prefixes '203.0.113.0/24' \
  --destination-port-ranges 22 \
  --access Allow
```

**List NSG Rules:**
```bash
az network nsg rule list --resource-group myResourceGroup --nsg-name myNSG
```
_Verification:_  
- Use Azure Portal or CLI to confirm rule status.

_Best Practice:_  
Always set specific source address/range, avoid '*' in production.

---

### GCP VPC & Firewall Rules

**Create Firewall Rule:**
```bash
gcloud compute firewall-rules create allow-ssh \
  --direction=INGRESS \
  --priority=1000 \
  --network=default \
  --action=ALLOW \
  --rules=tcp:22 \
  --source-ranges=203.0.113.0/24
```

**List Firewall Rules:**
```bash
gcloud compute firewall-rules list
```
_Verification:_  
- Use GCP Console or CLI to check rule status.

_Best Practice:_  
Use restrictive source ranges. Audit rules regularly.

---

## 9.11 Container & Kubernetes Networking

### Docker

Expose container port:
```bash
docker run -d -p 8080:8080 myapp
```
_Verification:_
```bash
curl localhost:8080
ss -tulnp | grep 8080
```

### Kubernetes

Simple NetworkPolicy example:
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-nginx
spec:
  podSelector:
    matchLabels:
      app: nginx
  ingress:
    - from:
        - ipBlock:
            cidr: 10.0.0.0/24
```
_Verification:_
```bash
kubectl describe networkpolicy allow-nginx
```

_Best Practice:_  
Use least-privilege policies—only allow required ports and traffic between containers/pods.

---

## 9.12 Infrastructure as Code (IaC) for Networking

### Example: Terraform AWS Security Group
```hcl
resource "aws_security_group" "web" {
  name        = "web-sg"
  description = "Allow HTTP and SSH"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["203.0.113.0/24"]
  }
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```
_Verification:_
```bash
terraform plan
terraform apply
aws ec2 describe-security-groups
```

### Example: Terraform Azure NSG
```hcl
resource "azurerm_network_security_group" "example" {
  name                = "example-nsg"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  security_rule {
    name                       = "AllowSSH"
    priority                   = 1000
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "Tcp"
    source_port_range          = "*"
    destination_port_range     = "22"
    source_address_prefix      = "203.0.113.0/24"
    destination_address_prefix = "*"
  }
}
```
_Verification:_
```bash
terraform plan
terraform apply
az network nsg rule list --resource-group <resource-group> --nsg-name example-nsg
```

### Example: Terraform GCP Firewall Rule
```hcl
resource "google_compute_firewall" "allow_ssh" {
  name    = "allow-ssh"
  network = "default"

  allow {
    protocol = "tcp"
    ports    = ["22"]
  }

  source_ranges = ["203.0.113.0/24"]
  direction     = "INGRESS"
  priority      = 1000
}
```
_Verification:_
```bash
terraform plan
terraform apply
gcloud compute firewall-rules list
```

_Best Practice:_  
Store all networking resources in version control and review via PR before deployment.

---

## 9.13 Monitoring & Troubleshooting

### Linux

- **Ping:** `ping 8.8.8.8`
- **Traceroute:** `traceroute example.com`
- **Socket state:** `ss -tulnp`
- **Firewall check:** `firewall-cmd --list-all`
- **System logs:** `journalctl -u NetworkManager`, `dmesg | grep eth`

### Cloud

- **AWS CloudWatch:** Monitor VPC flow logs.
- **Azure Monitor:** NSG flow logs.
- **GCP Logging:** VPC flow logs.

_Best Practice:_  
Aggregate logs and alerts centrally (e.g., ELK, Datadog, Splunk).

---

## 9.14 Security & Best Practices

| Area | Recommendation |
|------|---------------|
| Interface Naming | Use predictable names (`enp0s1`, `eth0`) |
| Automation | IaC (cloud-init, Terraform) for reproducible networking state |
| Firewalls | Default deny inbound; explicitly allow required service ports |
| DNS | Prefer redundant resolvers; monitor query latency |
| IPv6 | Do not disable blindly; secure with proper firewall rules |
| Logging | Log dropped packets (rate-limited) for forensic value |
| Ephemeral Changes | Avoid manual `ip` changes without persisting if required across reboots |
| NAT Awareness | Document translation points for troubleshooting |
| Cloud Security | Restrict CIDR, use tags/labels for resource grouping |
| Container Networking | Apply least-privilege network policies |
| Change Management | Always document and peer-review changes |

---

## 9.15 Cheat Sheet

```bash
# Show brief interface summary
ip -br a

# Assign temporary IPv4
ip addr add 10.10.5.25/24 dev eth0

# Remove that address
ip addr del 10.10.5.25/24 dev eth0

# Show default route
ip route | grep default

# Set DNS (NetworkManager)
nmcli connection modify eth0 ipv4.dns "1.1.1.1 8.8.8.8"

# Test outward path
traceroute 8.8.8.8

# Inspect open listening TCP ports
ss -tlnp

# HTTP header retrieval
curl -I https://example.com

# Quick DNS A record lookup
dig +short example.com

# Show firewall active ports (firewalld)
firewall-cmd --list-ports

# AWS SG rules
aws ec2 describe-security-groups

# Azure NSG rules
az network nsg rule list --resource-group myResourceGroup --nsg-name myNSG

# GCP firewall rules
gcloud compute firewall-rules list
```

---

## 9.16 Example Scenario: Static Configuration & Verification

1. Discover interface name:
   ```bash
   ip -br link
   ```
2. Assign static IP via NetworkManager:
   ```bash
   nmcli connection modify eth0 ipv4.addresses "192.168.50.10/24"
   nmcli connection modify eth0 ipv4.gateway "192.168.50.1"
   nmcli connection modify eth0 ipv4.dns "192.168.50.1 1.1.1.1"
   nmcli connection modify eth0 ipv4.method manual
   nmcli connection up eth0
   ```
3. Validate:
   ```bash
   ip addr show eth0
   ip route show
   ping -c 3 192.168.50.1
   dig +short example.com
   curl -I https://example.com
   ```

---

## 9.17 Cleanup & Reversion

If you added a temporary IP:
```bash
ip addr del 192.168.1.100/24 dev eth0
```

If you opened a firewall port (firewalld) for testing:
```bash
firewall-cmd --zone=public --remove-port=8080/tcp --permanent
firewall-cmd --reload
```

If you modified a NetworkManager connection incorrectly:
```bash
nmcli connection reload
nmcli connection modify eth0 ipv4.method auto
nmcli connection up eth0
```

---

## 9.18 Legacy vs Modern Summary

| Function | Legacy Tool(s) | Modern Preferred |
|----------|----------------|------------------|
| Interface management | `ifconfig` | `ip addr`, `ip link` |
| Routes | `route` | `ip route` |
| Sockets | `netstat` | `ss` |
| Firewall | `iptables` | `firewalld` (nftables) |
| DNS Query | `nslookup` | `dig`, `getent hosts` |

---

## 9.19 References (Suggested Further Study)

- RFC 1918 – Address Allocation for Private Internets
- RFC 5735 / 6890 – Special Use IPv4 Addresses
- `man ip`, `man nmcli`, `man firewalld.richlanguage`
- Linux Advanced Routing & Traffic Control HOWTO
- [AWS VPC Documentation](https://docs.aws.amazon.com/vpc/latest/userguide/)
- [Azure VNet Documentation](https://docs.microsoft.com/en-us/azure/virtual-network/)
- [GCP VPC Documentation](https://cloud.google.com/vpc/docs)
- [Docker Networking](https://docs.docker.com/network/)
- [Kubernetes Networking](https://kubernetes.io/docs/concepts/cluster-administration/networking/)
- [Terraform Networking](https://developer.hashicorp.com/terraform/tutorials/aws/aws-networking)
---

_Best Practice:_  
Continuously review, document, and automate your networking configurations for reliability, security, and scalability. Always verify after changes and monitor for early detection of issues.

---
