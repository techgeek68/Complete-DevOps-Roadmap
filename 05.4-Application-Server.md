# Application Servers

## What is an Application Server?
- Software framework to run dynamic web apps (e.g., Java Servlets, JSPs, APIs).
- Handles:
  - Business logic (transactions, security)
  - Resource management (connection pooling, clustering)
  - Java EE/Jakarta EE standards (Servlets, JSP, WebSocket)
- Examples: Tomcat, WildFly, WebLogic, GlassFish

## Web Server vs. Application Server

| Feature        | Web Server                         | Application Server                      |
|----------------|------------------------------------|-----------------------------------------|
| Primary Role   | Serves static content (HTML, CSS, JS) | Executes dynamic business logic          |
| Content        | Direct file delivery               | Processes code (e.g., Servlets/JSPs)    |
| Protocols      | HTTP/HTTPS only                    | HTTP/HTTPS + Jakarta EE APIs            |
| Examples       | Apache HTTPD, Nginx                | Tomcat, WildFly, WebLogic               |
| Use Case       | Static sites, reverse proxy        | Java web apps, APIs                     |

Summary: A web server handles HTTP requests for static files. An application server runs application code to generate dynamic content.

---

# Apache Tomcat â€” Installation & Configuration

## What is Tomcat?
- Open-source web server and servlet container for Java apps.
- Implements: Servlet, JSP, WebSocket, Expression Language (EL).
- Lightweight servlet/JSP container (not a full Java EE server).

## Tomcat Request Handling
```
+-------------------------------+      +-------------------------------+      +-------------------------------+
|      Client (Browser)         |<---->|    Coyote (HTTP connector)    |<---->|   Servlet engine (Catalina)   |
|  HTTP request                 |      |  Acceptor threads             |      |  Servlets/JSP processing      |
|  HTTP response                |      |  Worker threads               |      |                               |
|                               |      |  SSL/TLS encryption (if HTTPS)|      |                               |
+-------------------------------+      +-------------------------------+      +-------------------------------+
                                                                                |                               |
                                                                                |                               |
                                                                                v                               v
                                                                +-------------------------------+
                                                                | Jasper                        |
                                                                | (JSP engine, if JSP)          |
                                                                | JSP compilation (if JSP file) |
                                                                | and Java bytecode delivery    |
                                                                | for Catalina processing       |
                                                                +-------------------------------+
```
- Client (Browser): sends HTTP request, receives HTTP response.
- Coyote (HTTP Connector): Listens for incoming connections, SSL/TLS support, and hands requests to Catalina.
- Catalina (Servlet Engine): manages Servlet lifecycle; delegates JSPs to Jasper.
- Jasper (JSP Engine): compiles JSPs to Servlets (bytecode) returned to Catalina.

---

## Prerequisites
- 1 VM named tomcatserver

Set hostname:
```
  hostnamectl set-hostname tomcatserver.devopsclass.com
```
```
  exec bash
```

Configure network (TUI):
```
  nmtui
```

Install Java (RHEL/CentOS/Fedora-family):
```
dnf list *openjdk*
```
```
dnf -y install java-21-openjdk
```

---

## Install Tomcat (tar.gz method)
Check available versions or download from Apache:
```
dnf list *tomcat*
```
```
  wget https://downloads.apache.org/tomcat/tomcat-9/v9.0.106/bin/apache-tomcat-9.0.106.tar.gz
```

Or transfer a previously downloaded archive to the VM:

```
  scp apache-tomcat-11.0.8-fulldocs.tar.gz cnode@10.10.5.4:/home/cnode
```

Extract:
```
  tar -zxvf apache-tomcat-9.0.106.tar.gz
```

Default port: 8080

---

## Start/Stop & Basic Checks
Check if 8080 is listening:
```
  netstat -tnl | grep 8080
```

Start/Stop scripts:
```
cd apache-tomcat-9.0.106/bin
```
```
./startup.sh
```
```
./shutdown.sh
```

Optional: add Tomcat bin to PATH (recommended):
```
vim ~/.bashrc
```
Add:
```
export PATH=$PATH:/home/cnode/apache-tomcat-9.0.106/bin
```
Reload shell:
```
exec bash
```

Or create aliases:
```
vim ~/.bashrc
```
Add:
```
alias startup='/home/cnode/apache-tomcat-9.0.106/bin/startup.sh'
alias shutdown='/home/cnode/apache-tomcat-9.0.106/bin/shutdown.sh'
```
Reload:
```
exec bash
```

Re-check:
```
netstat -tnl | grep 8080
```

---

## Start Automatically on Reboot (rc.local)
Note: rc.local must exist and be executable.
```
vim /etc/rc.d/rc.local
```
Add full path to startup script:
```
/home/cnode/apache-tomcat-9.0.106/bin/startup.sh
```
Permissions:
```
chmod u+x /etc/rc.d/rc.local
```

---

## Change Tomcat Port
Check if the desired port (e.g., 5080) is free:
```
netstat -tnl | grep 5080
```

Edit server.xml:
```
cd /home/cnode/apache-tomcat-9.0.106/conf
vim server.xml
```
Find Connector and update:
```
<Connector port="5080" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" />
```

Open firewall:
```
firewall-cmd --permanent --add-port=5080/tcp
firewall-cmd --reload
```

---

## Secure Remote Access to Manager/Host-Manager
By default, access is restricted to localhost via RemoteAddrValve.

Host Manager context.xml:
```
cd /home/cnode/apache-tomcat-9.0.106/webapps/host-manager/META-INF
vim context.xml
```
Allow a specific IP (example 10.10.5.5):
```
<Context antiResourceLocking="false" privileged="true">
  <Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1|10\.10\.5\.5" />
</Context>
```

To allow a subnet (example 192.168.1.x):
```
allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1|192\.168\.1\.\d+"
```

Manager app has a similar file:
```
/home/cnode/apache-tomcat-9.0.106/webapps/manager/META-INF/context.xml
```

Note: Commenting the Valve removes IP restriction but is a security risk:
```
<!--
<Valve className="org.apache.catalina.valves.RemoteAddrValve"
       allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" />
-->
```

---

## Create Roles and Users (tomcat-users.xml)
```
cd /home/cnode/apache-tomcat-9.0.106/conf
sudo vim tomcat-users.xml
```
Add roles:
```
<role rolename="manager-gui"/>
<role rolename="manager-script"/>
<role rolename="manager-jmx"/>
<role rolename="manager-status"/>
```
Add a user and assign roles:
```
<user username="admin" password="devops"
      roles="manager-gui,manager-script,manager-jmx,manager-status"/>
```

Reload Tomcat to apply:
```
shutdown.sh
startup.sh
```

---

## Verify
Access remotely (use your server IP and port):
```
http://10.10.5.4:5080
```

Expected landing page text:
```
If you're seeing this, you've successfully installed Tomcat. Congratulations!
```

Open the Manager App and log in with the configured credentials:
```
http://10.10.5.4:5080/manager/html
```

---

## Quick Reference: Host-Manager vs Manager context.xml
- host-manager/META-INF/context.xml
  - Purpose: Configure Host Manager (manage virtual hosts).
  - Scope: Server-wide host administration.

- manager/META-INF/context.xml
  - Purpose: Configure Manager App (manage webapps).
  - Scope: Deploy/undeploy/start/stop applications; runtime controls.
