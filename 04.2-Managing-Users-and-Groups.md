# 3. Managing Users and Groups

---

Managing users and groups is a big part of a DevOps engineer’s job. It’s all about keeping systems secure, organized, and making sure access is handled automatically. As a DevOps engineer, you want to make sure the right people have the right access—no more, no less. It keeps your systems safe, organized, and easier to maintain, especially when things change or teams grow.

---

**What is a Group?**

A **group** is a collection of user accounts. Groups help you manage permissions for multiple users at once—making it easier to control access to files, folders, or tools.

**Types of Groups**

- **Primary Group:**  
  Each user is assigned to a primary group when their account is created. Files created by the user are usually associated with this group.
- **Secondary (or Supplementary) Groups:**  
  Users can also belong to additional groups, giving them access to more resources or permissions.
- **System Groups:**  
  Like system accounts, these are used by the system or software for specific tasks (for example, `sudo`, `docker`, `adm`).


---

## **1. Creating, Modifying, and Deleting Groups**

**Primary Group**
- Every user belongs to one main group—called the primary group. When you create a user, you can set this with useradd -g, but if you don’t, the system does it for you.
- You’ll see the primary group’s ID (GID) in the /etc/passwd file. For example:
  ```
  alice:x:1001:100:Alice:/home/alice:/bin/bash
  ```
  *100 is the GID of the primary group for alice.*

**Secondary Group**
- Users can also be part of extra groups—these are called secondary groups. You add them with useradd -G or later using usermod -aG.
- All group memberships are listed in /etc/group. If you want to edit group memberships directly, you can open the file:
- You can also edit group membership directly:
  ```
  vim /etc/group
  ```

**Create a Group**

```
groupadd developer
```
```
groupadd operation
```
```
groupadd support
```
```
groupadd -g 1009 admin                  # Creates group 'admin' with a specific GID
```

**View Groups Information**

```
cat /etc/group
```

*Format: `<groupname>:x:<GID>:<members>`*


**Modify a Group**

```
groupadd admin
```
```
groupmod -n administration admin
```
*(Renames 'admin' to 'administration')*


**Delete a Group**

```
groupdel admin
```

---

## **2. Creating, Modifying, and Deleting Users**

**What is a User?**

A **user** is basically an account that represents an individual (or sometimes a service) on a system. Users have their own credentials (like username and password), files, and permissions.

**Types of Users**

- **Normal/User Accounts:**  
  These are regular accounts for people who use the system, such as developers, admins, or team members.
- **System Accounts:**  
  Used by the operating system or installed software/services. These accounts run background processes and usually don’t log in like humans do (for example, `root`, `daemon`, `www-data`).
- **Root/Superuser:**  
  The "root" account has unlimited access to everything on the system. Used for administration and maintenance tasks.

  Syntax: `sudo adduser username`

**Create a User**

```
useradd harry
```
```
cat /etc/passwd | grep harry
```
*Format: `<username>:x:<UID>:<GID>:<Comment>:<home_directory>:<shell>`*

**Check User Groups**

```
groups harry
```

**Create User with Primary and Secondary Groups**

```
useradd -g developer -G operation david
```
```
groups david
```
*developer = primary group, operation = secondary group*

<img width="584" height="90" alt="Screenshot 2025-10-16 at 11 27 37 AM" src="https://github.com/user-attachments/assets/abe0715a-a4d9-4449-96cc-16a00e0bb642" />


**Create User with Home Directory, Shell, and Secondary Group**

This command creates a new user named Thomas, makes a home directory for him, sets his default shell to /bin/bash, and adds him to the wheel group (so he can use sudo):
```
useradd -m -s /bin/bash -G wheel thomas
```
```
passwd thomas
```
```
su – thomas
```
```
sudo useradd natasha
```

---

**Set or Change User Password**

Changing another user's password
```
sudo passwd natasha
```
```
su – natasha
```
```
whoami
```
```
exit
```
```
sudo passwd -l natasha
```
*(Lock natasha’s account)*
```
su – natasha
```
*(Should be denied)*
```
passwd -u natasha
```
*(Unlock natasha’s account)*
```
su – natasha
```
```
exit
```

<img width="822" height="804" alt="Screenshot 2025-10-16 at 11 35 25 AM" src="https://github.com/user-attachments/assets/a7136e20-8e93-41a1-bdb8-07dd04e4d247" />

---

**Modify an Existing User**

```
cat /etc/group | grep thomas
```
```
usermod -a -G operation thomas
```
```
cat /etc/group | grep thomas
```
```
usermod -g phpdev -G staff,support thomas
```
```
groups thomas
```

---

**Delete a User**

```
userdel -r david
```
*(Removes home and mail spool)*

```
cat /etc/passwd | grep david
```
```
cd /
```
```
cd home
```
```
ls
```
```
cd
```

<img width="599" height="175" alt="Screenshot 2025-10-16 at 11 47 34 AM" src="https://github.com/user-attachments/assets/c26a872e-1a67-4d00-9444-3ee8d20e5ef6" />

---

## **3. Managing Sudo Permissions**

**Edit Sudoers File Safely**

```
sudo visudo
```

**Allow a Specific User Passwordless Sudo**
Add the following line to allow the user natasha to run any command via sudo without a password prompt:
```
natasha ALL=(ALL) NOPASSWD: ALL
```
*(Allow user 'natasha' passwordless sudo)*


**Allow a Group Full Sudo (with Password)**
      
Search: `/%wheel`

*Key directives:*
```
%wheel ALL=(ALL) ALL
```
*(Allow group "wheel" full sudo)*

---

## **4. Managing Permissions and Ownership**

**Changing Ownership: chown**

```
touch htmlfile
```
```
mkdir htmldir
```

Shows new ownership for a file
```
ls -l htmlfile
```

Shows new ownership for a directory
```
ls -ld htmldir
```

Changes owner to natasha and group to developer for htmlfile.
```
sudo chown natasha:developer htmlfile
```

Changes owner of htmldir and all contents (if any) to harry.(recursively)
```
chown -R harry htmldir
```

```
ls -l htmlfile
```
```
ls -ld htmldir
```

<img width="590" height="389" alt="Screenshot 2025-10-16 at 12 00 13 PM" src="https://github.com/user-attachments/assets/9b6c06a7-8644-4359-b0f2-4d93700631ff" />

---

**Changing Permissions: chmod**

**Ownership Classes**
- User (u): Owner
- Group (g): Group
- Others (o): Everyone else

**Permission Types**
| Type    | Symbol | Numeric |
|---------|--------|---------|
| Read    | r      | 4       |
| Write   | w      | 2       |
| Execute | x      | 1       |
| Full    | rwx    | 7       |
| None    | -      | 0       |

**Examples**

```
touch permissionfile
```
```
mkdir permissiondir
```

```
ls -l permissionfile
```
```
ls -ld permissiondir
```

**Symbolic Notation**

Syntax:
```
chmod u+rwx file_name
```
```
chmod g-w file_name
```
```
chmod a=rw file_name
```

**Examples:**

Change directory permissions:
- Owner: read & execute
- Group: no permissions
- Others: unchanged
```
chmod u=rx, g= permissiondir
```
Verify:
```
ls -ld permissiondir
```

Enter the directory & create a file:
```
cd permissiondir
```
```
touch file
```
If you’re the owner, you can enter (x) and create (w) only if the owner has write permission.

```
cd
```

Change directory permissions:
  - Owner: rwx
  - Group: r-x
  - Others: no permissions
```
chmod u=rwx, g=rx,o= permissiondir
```
```
ls -ld permissiondir
```
```
cd permissiondir
```
```
touch file
```

Change directory permissions:
  - Owner: r-x
  - Group: no permissions
  - Others: unchanged
```
chmod u=rx, g= permfile
```
```
ls -l permfile
```
```
vim permfile
```
*(Try editing file to test permissions, If owner has no w permission, editing will fail (read-only).)*


**Octal Notation**

```
chmod 500 permissiondir
```
```
ls -ld permissiondir
```
```
cd permissiondir
```
```
touch file
```
```
chmod 750 permissiondir
```
```
ls -ld permissiondir
```
```
cd permissiondir
```
```
touch file
```

---

**Changing Group Ownership: chgrp**

```
chgrp admins file
```
```
chgrp team shared_dir/
```

---

## **5. umask, Sticky Bit, and Special Permissions**

**umask**

```
umask 022
```
*(Default: directories get 755, files get 644)*

*Set permanently:*
```
vim ~/.bashrc
```
*(or)*
```
vim /etc/profile
```

---

**Sticky Bit**

```
mkdir stickytest
```
```
chmod +t directory_name
```
```
chmod 1777 directory_name
```
```
chmod +t /shared_tmp
```

---

**Special Permissions**

**Setuid**

```
chmod u+s file_name
```
```
chmod 4755 file_name
```

**Setgid**

```
chmod g+s directory
```
```
chmod 2770 directory
```

---

## **6. Access Control Lists (ACLs)**

ACLs provide fine-grained permissions beyond the traditional user/group/other model.

**View ACLs**

```
getfacl file
```

**Modify ACLs**

```
setfacl -m u:david:rwx file
```
```
setfacl -m g:developer:r-- file
```
```
setfacl -x u:david file
```

**Default ACLs for Directories**

```
setfacl -d -m u:david:rwx dir/
```

*Note: Filesystem must be mounted with acl support.*

---

## **7. User Authentication & DevOps Workflows**

- **Centralized Authentication:**  
  - LDAP, OpenLDAP, Active Directory (winbind, SSSD), Kerberos

- **Pluggable Authentication Modules (PAM):**  
  - `/etc/pam.d/common-auth`, `common-password`, `common-session`
  - Configure 2FA, LDAP, password policies

- **Automation Tools:**  
  - Ansible, Puppet, Chef, Terraform for user/group/cloud IAM management

*Example: Ansible user module for idempotent user creation:*
```yaml
- name: Ensure user exists
  ansible.builtin.user:
    name: devuser
    groups: developers
    password: "{{ vault_user_password }}"
```

- **Secrets Management:**  
  - HashiCorp Vault, AWS Secrets Manager, Azure Key Vault

- **Container & CI Integration:**  
  - Users in Dockerfile, Kubernetes RBAC, CI pipeline service accounts

---

**Additional Knowledge**

- **Best Practices**: Always use a root account for these operations in test environments; use sudo in production.
- **Automation**: Use configuration management tools (Ansible, Puppet, Chef) for repeatable user/group/permission management.
- **Security**: Audit `/etc/passwd`, `/etc/group`, and `/etc/sudoers` regularly. Lock unused accounts and enforce password policies.
- **More Examples**: For container workflows, define users in Dockerfiles:
  ```
  USER appuser
  ```
  Or manage service accounts in Kubernetes:
  ```
  kubectl create serviceaccount buildbot
  ```

----
