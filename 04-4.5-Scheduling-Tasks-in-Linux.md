# 7. Scheduling Tasks in Linux

Automation and monitoring are essential for DevOps. Linux offers robust tools for scheduling tasks and managing logs. This guide covers cron, at, scheduled jobs, and log management with practical examples.

---

## 1. Cron for Recurring Jobs

Cron is used for running scheduled tasks automatically at specified intervals.

### **Editing Crontab**

Edit your user's cron jobs:
```
crontab -e
```

### **Crontab Syntax**
```
* * * * * command
# ┬ ┬ ┬ ┬ ┬
# │ │ │ │ │
# │ │ │ │ └─ Day of Week (0 - 6) (Sunday=0)
# │ │ │ └──── Month (1 - 12)
# │ │ └────── Day of Month (1 - 31)
# │ └──────── Hour (0 - 23)
# └────────── Minute (0 - 59)
```

#### **Field Values**
- Minute: 0–59
- Hour: 0–23
- Day of Month: 1–31
- Month: 1–12
- Day of Week: 0–6 (0=Sun, 1=Mon...)

---

### **System-Wide Jobs**
System-wide jobs are managed by root and scripts are placed in:
- `/etc/cron.daily/`
- `/etc/cron.hourly/`
- `/etc/cron.weekly/`
- `/etc/cron.monthly/`

Navigate to these folders:
```
cd /etc/cron.daily
```
```
cd /etc/cron.hourly
```
```
cd /etc/cron.weekly
```
```
cd /etc/cron.monthly
```

Or edit system crontab:
```
sudo vim /etc/crontab
```

---

### **Cron Examples**

**Daily at 3 AM:**
```
0 3 * * * /path/to/script.sh
```

**Every 15 minutes:**
```
*/15 * * * * command
```

**Weekdays at 5 PM:**
```
0 17 * * 1-5 command
```

**Special Strings:**
```
@daily /path/to/script.sh
@reboot /path/to/script.sh
@hourly command
@monthly command
```

**Append logged-in users, memory status, and date at 9:00 am each day:**
```
00 09 * * * (who; free -h; date) >> ~/loginlist
```

**Each minute:**
```
* * * * * who >> ~/loginlist
```

**Each 15 min:**
```
*/15 * * * * who >> ~/presentlist
```

**Check for logged in user, memory status & date every 2 min:**
```
*/2 * * * * (who; date) >> ~/listwithdate
```

**Every 2 min, memory & disk info:**
```
*/2 * * * * (echo "= $(date) ="; free -h; df -h) >> ~/info
```

**Run system command (needs full path):**
```
39 03 * * * /usr/sbin/reboot
```

---

## 2. Managing Crontab

- **Edit cronjobs:**
    ```
    crontab -e
    ```
- **List jobs:**
    ```
    crontab -l
    ```
- **Remove all jobs:**
    ```
    crontab -r
    ```
- **Set environment variables (at the top of crontab):**
    ```
    PATH=/usr/local/bin:/usr/bin:/bin
    ```
- **Restart cron service after updates (for system jobs):**
    ```
    sudo systemctl restart crond.service
    ```
- **Redirect output to log file or discard:**
    ```
    command > /path/to/log 2>&1
    command > /dev/null 2>&1
    ```

---

## 3. One-Time Jobs with `at`

Schedule jobs to run once at a specific time:
```
at 18:00
```
Type commands, then press Ctrl+D.

List scheduled jobs:
```
atq
```

Remove a job:
```
atrm <job_number>
```

---

# 8. Viewing and Managing Logs

Linux systems keep logs for troubleshooting, auditing, and monitoring.

## 1. Understanding Log Locations

Most logs are stored in `/var/log/`.

**Common Log Files:**
- `/var/log/syslog` or `/var/log/messages`: General system activity.
- `/var/log/auth.log` or `/var/log/secure`: Authentication & security.
- `/var/log/kern.log`: Kernel messages.
- `/var/log/boot.log`: Boot process.
- Application logs:
    - `/var/log/nginx/`
    - `/var/log/apache2/`
    - `/var/log/mysql/`

**Log Format Example:**
```
<timestamp> <hostname> <service_name>[pid]: <message>
```

**Systemd Journals:** Binary logs managed by journald, often in `/var/log/journal`.

---

## 2. Viewing Logs

Change to the log directory:
```
cd /var/log
```
```
ls
```

**Display entire log file (use sparingly for large files):**
```
sudo cat boot.log
```
```
sudo cat messages
```

**View last N lines:**
```
sudo tail -n 20 secure
```
```
sudo tail -f messages
```

**Follow logs in real-time and filter:**
```
tail -f /var/log/syslog | grep "error"
```

**Try logging in with wrong password, then:**
```
tail -n 10 secure
```

**Navigate logs interactively:**
```
less dnf.log
```
Search: `/pattern`, Quit: `q`

**Filter logs for patterns:**
```
sudo tail secure | grep "failed"
```
```
zgrep "failed" /var/log/auth.log.1.gz
```

---

**Systemd Logs (`journalctl`):**
```
journalctl -u nginx.service           # Logs for nginx service
journalctl -b                        # Logs since last boot
journalctl -p err -b                 # Errors since last boot
journalctl -f                        # Follow new logs
journalctl --since "2024-10-01" --until "2025-04-02"
journalctl -u sshd > sshd_logs.txt   # Export SSH logs to text
```

---

## 3. Rotating Logs with logrotate

Prevents logs from consuming excessive disk space by compressing and archiving old logs.

**Main configuration:**
```
cat /etc/logrotate.conf
```

**Service-specific configs:**
```
cd /etc/logrotate.d/
```
```
cat /etc/logrotate.d/nginx
```

**Example logrotate config for Nginx:**
```
/var/log/nginx/*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        systemctl reload nginx
    endscript
}
```

**Manual Execution:**
```
sudo logrotate -vf /etc/logrotate.d/nginx   # Force rotation, verbose
```
```
logrotate -d /etc/logrotate.d/nginx         # Dry run
```

**Check status file for last rotations:**
```
cat /var/lib/logrotate/status
```

---

## **Best Practices and Tips**

- Use `sudo` to access restricted logs (e.g., /var/log/auth.log).
- For large logs, prefer `less` or `tail` over `cat`.
- Combine `grep` with `tail -f` for real-time filtering.
- Always check logrotate status and configure rotation on custom logs.
- Use cron for regular maintenance tasks (e.g., backups, log rotation).

---
