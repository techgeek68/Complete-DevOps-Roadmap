# 5. Package Management

Package management is essential for installing, updating, and maintaining software on Linux systems. This guide covers key tools, concepts, and commands for managing packages, dependencies, compiling from source, and managing services.

---

## 1. Package Managers by Distribution

- **Debian/Ubuntu (and derivatives):** `apt`, `dpkg`
- **Red Hat/Fedora/CentOS:** `dnf` (or `yum` for older systems), `rpm`
- **Arch Linux/Manjaro:** `pacman`
- **openSUSE:** `zypper`, `rpm`

*Explanation: Each Linux distribution uses its own package manager, which handles installation, updates, and removal of software packages.*

---

## 2. Querying Packages

### **Search for Available Packages**

**Debian/Ubuntu:**
```
apt search <keyword>
```
```
apt search apache
```
```
apt search database
```

**Red Hat/Fedora/CentOS:**
```
dnf search <keyword>
```
```
yum search <keyword>
```
```
dnf search webserver
```
```
dnf search apache
```
```
dnf search sql
```
```
dnf search database
```

**Arch Linux:**
```
pacman -Ss <keyword>
```

**openSUSE:**
```
zypper search <keyword>
```

*Explanation: These commands help you find software packages available for installation in your distribution's repositories.*

---

### **View Package Information**

**Debian/Ubuntu:**
```
apt show <package>
```

**Red Hat/Fedora/CentOS:**
```
dnf info <package>
```
```
yum info <package>
```
```
dnf info gzip
```
```
dnf info tar
```
```
dnf info mariadb
```
```
dnf info httpd
```

**Arch Linux:**
```
pacman -Si <package>    # Info about a package in the repo
```
```
pacman -Qi <package>    # Info about an installed package
```

**openSUSE:**
```
zypper info <package>
```

*Explanation: Use these commands to get details about a package, such as version, description, and dependencies.*

---

### **List Installed Packages**

**Debian/Ubuntu:**
```
dpkg -l | grep <package>
```

**Red Hat/Fedora/CentOS:**
```
dnf list installed
```
```
yum list installed
```
```
rpm -qa | grep <package>
```
```
rpm -qa | grep tar
```
```
rpm -qa | grep httpd
```

**Arch Linux:**
```
pacman -Q | grep <package>
```

**openSUSE:**
```
zypper search --installed | grep <package>
```

*Explanation: List all installed packages or check if a specific package is installed.*

---

### **Find Which Package Owns a File**

**Debian/Ubuntu:**
```
dpkg -S </path/to/file>
```

**Red Hat/Fedora/CentOS:**
```
rpm -qf </path/to/file>
```
```
rpm -qf /usr/bin/tar
```
```
rpm -qf /etc/yum.repos.d
```

**Arch Linux:**
```
pacman -Qo </path/to/file>
```

**openSUSE:**
```
zypper wp </path/to/file>
```

*Explanation: If you find a file on your system and want to know which package installed it, use these commands.*

---

## 3. Installing Packages

### **From Repositories**

**Debian/Ubuntu (.deb packages):**

**High-Level Tool:**
```
sudo apt update
```
```
sudo apt install <package>
```
```
sudo apt upgrade
```

*Explanation: `apt` handles package installation, upgrades, and dependency resolution automatically.*

**Low-Level Tool:**
```
sudo dpkg -i <package.deb>
```

*Explanation: `dpkg` installs .deb files directly but does not resolve dependencies; use `apt install -f` to fix broken dependencies.*

---

**Red Hat/Fedora/CentOS (.rpm packages):**

**High-Level Tools:**
```
sudo dnf update
```
```
sudo dnf install <package>
```
```
sudo dnf remove <package>
```
```
sudo dnf -y install httpd
```
```
sudo dnf -y install mariadb
```
```
sudo dnf -y install git
```

**yum (older systems):**
```
sudo yum install <package>
```
```
sudo yum update
```

*Explanation: `dnf` is the modern package manager for RHEL and Fedora. `yum` is still used on older systems.*

**Low-Level Tool:**
```
sudo rpm -ivh <package.rpm>
```
```
sudo rpm -e <package>
```

*Explanation: `rpm` installs and removes .rpm files directly but does not resolve dependencies.*

---

**Arch Linux:**
```
sudo pacman -S <package>
```

*Explanation: `pacman` installs packages and resolves dependencies for Arch Linux.*

---

**openSUSE:**
```
sudo zypper refresh
```
```
sudo zypper install <package>
```

*Explanation: `zypper` is the command-line interface for managing packages in openSUSE.*

---

### **From Local Files**

**Debian/Ubuntu:**
```
sudo dpkg -i <package.deb>
```
```
sudo apt install -f
```

**Red Hat/Fedora:**
```
sudo dnf install <package.rpm>
```
```
sudo rpm -i <package.rpm>
```

**Arch Linux:**
```
sudo pacman -U <package.pkg.tar.zst>
```

**openSUSE:**
```
sudo zypper install <package.rpm>
```

*Explanation: These commands install packages you've downloaded manually or built yourself.*

---

## 4. Removing Packages

**Debian/Ubuntu:**
```
sudo dpkg -r <package>
```
```
sudo dpkg -P <package>
```
```
sudo apt remove <package>
```
```
sudo apt purge <package>
```

**Red Hat/Fedora/CentOS:**
```
sudo dnf remove <package>
```
```
sudo yum remove <package>
```
```
sudo dnf remove nginx
```
```
sudo dnf -y remove httpd
```
```
sudo dnf -y remove mariadb
```
```
sudo dnf -y remove git
```

**Arch Linux:**
```
sudo pacman -R <package>
```
```
sudo pacman -Rns <package>
```

**openSUSE:**
```
sudo zypper remove <package>
```

*Explanation: These commands remove packages from your system. Use purge or clean options to remove configuration files as well.*

---

### **Clean Up Unused Dependencies**

**Debian/Ubuntu:**
```
sudo apt autoremove
```

**Red Hat/Fedora/CentOS:**
```
sudo dnf autoremove
```

**Arch Linux:**
```
sudo pacman -Rns $(pacman -Qdtq)
```

**openSUSE:**
```
sudo zypper rm --clean-deps <package>
```

*Explanation: Unused dependencies can accumulate over time. These commands remove orphaned libraries and packages.*

---

## 5. Updating Packages

**Debian/Ubuntu:**
```
sudo apt update && sudo apt upgrade
```
```
sudo apt full-upgrade
```

**Red Hat/Fedora/CentOS:**
```
sudo dnf upgrade
```

**Arch Linux:**
```
sudo pacman -Syu
```

**openSUSE:**
```
sudo zypper update
```

*Explanation: Regularly updating packages helps keep your system secure and stable.*

---

## 6. Understanding Package Dependencies

Package dependencies are other software packages (libraries, tools, or programs) that a specific package requires to function properly.

**Automatic Resolution:**
```
sudo dnf install <package>
```

*Explanation: Modern package managers automatically install required dependencies for you.*

**Manual Resolution:**
```
sudo apt install -f
```
```
sudo dnf install <package.rpm>
```

*Explanation: If you install a package with a low-level tool and dependencies are missing, use these commands to fix them.*

---

## 7. Installing Software from Source

When pre-built packages are unavailable, software can be compiled from source.

**Example: Download and install Node.js 20.x on CentOS 9/RHEL 9**
```
wget https://nodejs.org/dist/v20.11.1/node-v20.11.1-linux-x64.tar.xz
```
```
ls
```
```
tar -xvf node-v20.11.1-linux-x64.tar.xz
```
```
cd node-v20.11.1-linux-x64
```
```
sudo cp -r bin include lib share /usr/local/
```
```
node -v
```
```
npm -v
```

*Explanation: Download the software, extract it, move the binaries to a system path, and verify installation.*

---

## 8. Managing Services

Managing services is essential for running applications and ensuring their availability.

### **Managing Services with systemctl and systemd**

**Start a service:**
```
sudo systemctl start service_name
```

**Stop a service:**
```
sudo systemctl stop service_name
```

**Restart a service:**
```
sudo systemctl restart service_name
```

**Reload a service (apply config changes):**
```
sudo systemctl reload service_name
```

**Check status:**
```
systemctl status service_name
```

**Enable service at boot:**
```
sudo systemctl enable service_name
```

**Disable service from boot:**
```
sudo systemctl disable service_name
```

*Explanation: systemctl manages services (daemons) on systems using systemd.*

---

### **Understanding systemd Units**

**List system-wide services:**
```
cd /usr/lib/systemd/system/
```

**List user-specific services:**
```
cd /etc/systemd/system/
```

**Reload after editing unit files:**
```
sudo systemctl daemon-reload
```

**View dependencies:**
```
systemctl list-dependencies service_name
```
```
systemctl list-dependencies tar
```
```
systemctl list-dependencies gzip
```
```
systemctl list-dependencies httpd
```
```
systemctl list-dependencies nginx
```

*Explanation: Unit files define how services are started and managed. Use these commands to inspect and reload unit configurations.*

---

### **Troubleshooting Services**

**View logs for a service:**
```
journalctl -u service_name
```

**Follow real-time logs:**
```
journalctl -u service_name -f
```

**Filter logs by time:**
```
journalctl --since "2024-01-01 00:00:00"
```
```
journalctl --since "1 hour ago"
```

**Show errors only:**
```
journalctl -p err -u service_name
```

**Check service status for errors:**
```
systemctl status service_name
```

**Validate unit file syntax:**
```
systemd-analyze verify service_name
```

**Check if service is enabled:**
```
systemctl is-enabled service_name
```
```
systemctl is-enabled nginx
```

**List listening ports:**
```
netstat -tnl
```
```
netstat -tnl | grep 80
```
```
netstat -tnl | grep 22
```

---

**Stop and disable a service:**
```
sudo systemctl stop httpd
```
```
sudo systemctl disable httpd
```

**Check service-specific logs:**
```
journalctl -u httpd --since today
```

*Explanation: Use these tools to monitor, troubleshoot, and manage the lifecycle of system services.*

---
