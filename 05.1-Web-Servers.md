# Web Servers: Apache & Nginx, Hosting, Security, Load Balancing, and Enterprise Enhancements

This guide covers installing and configuring Apache and Nginx web servers for hosting static, PHP, and Python websites; securing with HTTPS; SSH login; and setting up Nginx as a load balancer. Includes SELinux, firewall, multi-site/virtual host scenarios, and enterprise topics for modern DevOps environments.

---

**Web Servers:**
 - A software application or a combination of hardware and software that stores, processes, and delivers web pages to users via HTTP/HTTPS.
   - Hardware: Physical machine storing server software and website files, connected to the internet.
   - Software: Applications like Apache, Nginx, IIS that process requests and manage content delivery.
- Key Functions:
  - Storing Content, Request handling, load balancing, SSL termination, Caching, Handling Protocols
- Types:
  - Static: Serve pre-existing files (HTML, CSS, JS, images)
  - Dynamic: Process requests via applications (Python, PHP, Node.js)
    
- Popular Web Servers
  - Nginx
    - Architecture: Event-driven, asynchronous
    - Use Cases: Reverse proxy, load balancer, static content server
    - Config: /etc/nginx/nginx.conf, server blocks
    - Pros: High performance, low memory footprint

  - Apache HTTP Server
    - Architecture: Process/thread-based (MPM)
    - Use Cases: Dynamic content, .htaccess flexibility
    - Config: /etc/httpd/conf/httpd.conf, .htaccess
    - Pros: Modular (modules), extensive feature set
      
  - Other examples are - Caddy, LiteSpeed, Apache Tomcat, Microsoft IIS (Internet Information Services), Jigsaw, 
Jigsaw, Oracle iPlanet Web Server, Lighttpd etc...


**SSH Login for Remote Server Access**
- Linux/Unix:
  - Syntax:
  ```bash
    ssh devops@<Server_IP> or <Server_hostname>
  ```

- Windows: 
- For Windows 8 and earlier:
- Download & install [MobaXterm](https://mobaxterm.mobatek.net/)  
  - Start local terminal
    
- SSH works natively on Windows 10 (build 1809 and later) and Windows 11
  - Open a terminal (Command Prompt, PowerShell, or Windows Terminal).
  - Check if SSH is installed by typing ssh; a usage message means it’s ready.
  - If not installed, go to Settings > Apps > Optional features > Add a feature and install OpenSSH Client.


  - Example:
  ```bash
  ssh devops@192.168.100.172
  ssh -p 2222 devops@server-ip      # Custom port
  ```
  

**SSH Configuration File (~/.ssh/config)**
```bash
Host webserver
    HostName 192.168.100.172
    User devops
    Port 22
    IdentityFile ~/.ssh/webserver_key

Host appserver
    HostName 192.168.100.173  
    User devops
    ProxyJump webserver  # Bastion host
```


---


**Apache HTTP Server (Apache)**

Introduction:
* Free, open-source, cross-platform web server.
* Developed by Apache Software Foundation.
* Historically the most popular web server; now shares market with Nginx.

Key Features:
* Open source, free to use and modify, with large community support.
* Modular architecture, extended via modules such as SSL, URL rewriting, and security.
* Cross-platform, works on Linux, Windows, macOS, and Unix.
* .htaccess support allows directory-level configuration for flexible hosting.
* Robust and stable, reliable under high traffic.
* Strong security with regular updates and security modules.

How it Works:
* Listens on HTTP/HTTPS ports (80/443).
* Serves requested web pages or resources to clients.
* Uses Multi-Processing Modules (MPMs):
  * prefork: process-based, safe for non-threaded libraries.
  * worker: multi-threaded, better performance under load.

Common Uses:
* Hosting static websites (HTML, CSS, images).
* Hosting dynamic websites using PHP, Python, or Perl via modules.
* Acting as reverse proxy or load balancer for application servers.


**A. Install & Start Apache (CentOS/RHEL/Fedora)**
```bash
rpm -q httpd                   # Check if the Apache HTTP Server package is installed

sudo yum update -y             # Update all installed packages to the latest version automatically
sudo yum install httpd -y      # Install Apache HTTP Server without prompting for confirmation

sudo systemctl start httpd     # Start the Apache HTTP Server service immediately
sudo systemctl enable httpd    # Enable Apache to start automatically at boot
sudo systemctl status httpd    # Check the status of Apache service

httpd -v                       # Display Apache version
```

<img width="663" height="87" alt="Screenshot 2025-11-05 at 12 06 30 PM" src="https://github.com/user-attachments/assets/718733de-b209-4ab6-98ae-4aa51583eba8" />



**B. Open Firewall Ports**
```bash
sudo firewall-cmd --permanent --add-service={http,https}   # Open HTTP port (80) & HTTPS port (443) permanently

sudo firewall-cmd --reload                                # Apply the new firewall rules

sudo firewall-cmd --list-all                              # Verify active services and open ports
```

<img width="665" height="471" alt="Screenshot 2025-11-05 at 12 13 53 PM" src="https://github.com/user-attachments/assets/40e7d132-f844-4ece-b38d-f8190a72a673" />

<img width="659" height="363" alt="Screenshot 2025-11-05 at 12 19 20 PM" src="https://github.com/user-attachments/assets/7a8673aa-d79c-4a01-aa69-5b4c08a16eba" />


**C. Verify Installation**
  - Visit:
    - http://server-ip
          or
    - http://localhost
          or
    - http://127.0.0.1

<img width="805" height="575" alt="Screenshot 2025-11-05 at 12 22 18 PM" src="https://github.com/user-attachments/assets/1ee0d323-42d5-4e2e-bbea-c6a4d62cff7e" />

      
  - Check hosts: cat /etc/hosts
  
  <img width="716" height="165" alt="Screenshot 2025-11-05 at 12 20 24 PM" src="https://github.com/user-attachments/assets/71fb04f2-84e4-4261-9670-6d6a5b9a8655" />


---

**Hosting a Static Website**

**A. Directory Setup**
```bash
# Create web directory
sudo mkdir -p /var/www/html
sudo mkdir -p /var/www/html/{page1,page2}

# Set permissions
sudo chown -R apache:apache /var/www/html
sudo chmod -R 755 /var/www/html

# Verify ownership
ls -lh /var/www/
```

**B. Create Pages**
```bash
cd /var/www/html
# Main page
sudo vim /var/www/html/index.html
```

```bash
<!DOCTYPE html>
<html>
<head>
    <title>Static Website</title>
</head>
<body>
    <h1>This is a static website!!!</h1>
    <p><a href="/page1">Page 1</a> | <a href="/page2">Page 2</a></p>
</body>
</html>
```

```bash
# Subdirectory pages
sudo vim /var/www/html/page1/index.html
sudo vim /var/www/html/page2/index.html
```

```bash
sudo systemctl restart httpd
```

**C.Test**
Visit: `http://127.0.0.1/`, `http://127.0.0.1/page1`, `http://127.0.0.1/page2`



---

## 4. Apache Main Configuration

- Main config: `/etc/httpd/conf/httpd.conf`
  ```
  DocumentRoot "/var/www/html"
  ```

- Custom Virtual Host:
  ```bash
  cd /etc/httpd/conf.d
  vi mywebsite.conf
  ```
  ```
  <VirtualHost *:80>
      ServerName www.mywebsite.com
      ServerAlias www.mywebsite.com
      DocumentRoot /var/www/html/mywebsite
  </VirtualHost>
  ```
  ```bash
  httpd -t
  systemctl restart httpd
  ```

---

## 5. Multiple Websites with Virtual Hosts

### A. Directory Structure
```bash
cd /var/www
sudo mkdir -p example1.com/public_html
sudo mkdir -p example2.com/public_html
sudo chown -R apache:apache example1.com/public_html
sudo chown -R apache:apache example2.com/public_html
sudo chmod -R 755 /var/www
```

### B. Sample Pages
Place `index.html` in both `public_html` directories.

### C. Virtual Host Configs
- `example1.com.conf`:
  ```
  <VirtualHost *:80>
      ServerAdmin admin@example1.com
      ServerName example1.com
      ServerAlias www.example1.com
      DocumentRoot /var/www/example1.com/public_html
  </VirtualHost>
  ```
- `example2.com.conf`:
  ```
  <VirtualHost *:80>
      ServerAdmin admin@example2.com
      ServerName example2.com
      ServerAlias www.example2.com
      DocumentRoot /var/www/example2.com/public_html
  </VirtualHost>
  ```
```bash
sudo apachectl configtest
sudo systemctl restart httpd
```
### D. Local Testing
Edit `/etc/hosts` on your local machine:
```
SERVER_IP example1.com
SERVER_IP example2.com
```

---

## 6. Hosting PHP Websites

### A. Install Apache & PHP
```bash
sudo dnf update -y
sudo dnf install httpd -y
sudo dnf install php -y
sudo systemctl start httpd
sudo systemctl enable httpd
php -v
```
### B. Firewall
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```
### C. Directory & Permissions
```bash
sudo mkdir -p /var/www/phpwebsite
sudo chown -R apache:apache /var/www/phpwebsite
sudo chmod -R 755 /var/www
```
### D. Virtual Host Config
`/etc/httpd/conf.d/phpwebsite.conf`:
```
<VirtualHost *:80>
    ServerAdmin admin@phpwebsite
    ServerName phpwebsite
    ServerAlias www.phpwebsite
    DocumentRoot /var/www/phpwebsite
    <FilesMatch \.php$>
      SetHandler "proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"
    </FilesMatch>
</VirtualHost>
```
### E. PHP-FPM
```bash
sudo vi /var/www/phpwebsite/index.php
# <?php phpinfo(); ?>
sudo systemctl restart httpd
sudo systemctl start php-fpm
sudo systemctl enable php-fpm
sudo apachectl configtest
sudo systemctl restart httpd
```
Test: `http://127.0.0.1/`

---

## 7. Hosting Python Websites (mod_wsgi)

### A. Install Apache, Python, mod_wsgi
```bash
sudo dnf update -y
sudo dnf install httpd python3 python3-mod_wsgi -y
sudo systemctl start httpd
sudo systemctl enable httpd
```
### B. Firewall
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```
### C. Directory & Permissions
```bash
cd /var/www
sudo mkdir python
cd python
sudo vim myweb.py
# Python WSGI application code
sudo chown -R apache:apache /var/www/python
sudo chmod -R 755 /var/www
```
### D. Virtual Host Config
`/etc/httpd/conf.d/python.conf`:
```
<VirtualHost *:80>
    ServerAdmin admin@python
    ServerName python
    ServerAlias www.python.com
    WSGIScriptAlias / /var/www/python/myweb.py
</VirtualHost>
```
### E. Restart & Test
```bash
sudo systemctl restart httpd
sudo apachectl configtest
```
Test: `http://127.0.0.1/`

---

## 8. Hosting a Secure Site (HTTPS/SSL with Apache)

### A. Install SSL Packages
```bash
rpm -q httpd mod_ssl openssl
dnf -y install mod_ssl openssl httpd
```
### B. Firewall
```bash
firewall-cmd --list-all
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
firewall-cmd --list-all
```
### C. SSL Configuration
Edit `/etc/httpd/conf.d/ssl.conf`:
```
SSLCertificateFile /etc/pki/tls/certs/localhost.crt
SSLCertificateKeyFile /etc/pki/tsl/private/localhost.key
```
### D. Self-signed Certificate
```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -out /etc/pki/tls/certs/localhost.crt -keyout /etc/pki/tls/private/localhost.key
```
### E. DocumentRoot/Permissions
```bash
sudo mkdir -p /var/www/devopsclass
sudo chown apache:apache /var/www/devopsclass
sudo chmod 755 /var/www/devopsclass
cd /var/www/devopsclass
vim index.html
# <h1> testing secure site!! </h1>
```
### F. Virtual Host for HTTPS
`/etc/httpd/conf.d/devopsclass.conf`:
```
<VirtualHost *:443>
    ServerName www.devopsclass.com
    DocumentRoot /var/www/devopsclass
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
</VirtualHost>
```
### G. Restart & Test
```bash
httpd -t
systemctl restart httpd
```
Test: `https://127.0.0.1/`  
(Proceed past the browser warning for self-signed certificate)

---

## 9. Nginx Web Server Setup

### A. Remove/Stop Apache (if needed)
```bash
dnf -y remove httpd
systemctl stop httpd
systemctl disable httpd
```
### B. Install & Start Nginx
```bash
dnf -y install nginx
systemctl start nginx
systemctl enable nginx
```
### C. Firewall
```bash
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```
### D. Default Page & Config
```bash
cd /usr/share/nginx/html
sudo mkdir devops
cd devops
sudo vim index.html
# <h1> Testing nginx Web Server </h1>
cd /etc/nginx/conf.d
sudo vim devops.conf
# server {
#   listen 80;
#   server_name 192.168.64.4; # or www.devops.com
#   root /usr/share/nginx/html/devops;
#   index index.html;
# }
sudo nginx -t
sudo systemctl restart nginx
```
Test: `http://127.0.0.1/`

---

## 10. Load Balancer Setup Using Nginx

### A. Architecture
- 3 VMs: Load Balancer (192.168.64.5), Node 1 (192.168.64.6), Node 2 (192.168.64.7)

### B. Configure Load Balancer
```bash
hostnamectl set-hostname loadbalancer
dnf -y install nginx
systemctl start nginx
systemctl enable nginx
firewall-cmd --permanent --add-service=http
firewall-cmd --reload
cd /etc/nginx/conf.d
sudo vim loadbalance.conf
```
```
upstream backend_servers {
    server 192.168.64.6;
    server 192.168.64.7;
}
server {
    listen 80;
    server_name 192.168.64.5;
    location / {
        proxy_pass http://backend_servers;
    }
}
```
Test & restart:
```bash
sudo nginx -t
sudo systemctl restart nginx
```

### C. Configure Backend Servers (Node 1 & Node 2)
- Install & start nginx, open firewall, create `devops/index.html` in `/usr/share/nginx/html`
- Node1: `server_name 10.10.5.6`
- Node2: `server_name 10.10.5.7`
- Update `/etc/nginx/conf.d/node1.conf` and `/etc/nginx/conf.d/node2.conf` for each node.

---

## 11. SELinux and Security

- Check SELinux status:
  ```bash
  getenforce
  ```
- View logs:
  ```bash
  sudo cat /var/log/audit/audit.log | grep nginx
  ```
- List and set booleans:
  ```bash
  getsebool -a
  getsebool -a | grep network
  setsebool -P httpd_can_network_connect=1
  getsebool -a | grep httpd_can_network_connect
  ```

---

## 12. Ultra-Enterprise Enhancements

### A. Advanced Application-Level Monitoring (APM)
- Integrate tools like **New Relic**, **Datadog APM**, **Elastic APM** for real-time web transaction tracing, error detection, and performance analytics.
- Instrument web apps for latency, throughput, slow queries, distributed tracing, and user experience.

### B. Automated Certificate Management (Let's Encrypt, Certbot)
- Use **Certbot** for free SSL/TLS certificates and auto-renewal:
  ```bash
  sudo dnf install certbot python3-certbot-apache
  sudo certbot --apache
  # For Nginx:
  sudo dnf install certbot python3-certbot-nginx
  sudo certbot --nginx
  # Schedule renewal:
  echo "0 0 * * * certbot renew --quiet" | sudo tee /etc/cron.d/certbot-renew
  ```
- Integrate certificate lifecycle management with monitoring and alerting.

### C. Infrastructure as Code (IaC)
- Use **Terraform** and **Ansible** for automated, repeatable deployments of web servers, load balancers, firewalls, certificates, and DNS.
- Example: Terraform for AWS EC2 + Ansible for Apache setup.
- Store configurations in version control and integrate with CI/CD for automated provisioning and rollback.

### D. Containerized Web Servers (Docker, Kubernetes Ingress)
- Deploy web servers as Docker containers for portability and scalability:
  - Example:  
    ```bash
    docker run -d -p 80:80 --name webserver -v /site:/usr/share/nginx/html nginx
    ```
- Use **Kubernetes** with **Ingress controllers** for scalable, self-healing deployments, SSL termination, and advanced routing.
- Define web apps and load balancers in YAML manifests and manage with `kubectl`.

### E. CI/CD Integration for Automated Updates
- Connect GitHub/GitLab CI/CD pipelines to build, test, and deploy web server updates automatically.
- Example:  
  - Push to main branch triggers Ansible playbook or Docker build/deploy.
  - Use pipeline stages for syntax check (`nginx -t`, `httpd -t`), unit/integration tests, and production rollout.

### F. Web Application Firewall (WAF) Configuration
- Deploy WAFs (e.g., **ModSecurity** for Apache/Nginx, AWS WAF, Cloudflare WAF) to block attacks (SQL injection, XSS, etc).
- Configure security rules, monitor logs, and integrate with SIEM for threat detection.
- Example for ModSecurity with Apache:
  ```bash
  sudo dnf install mod_security
  sudo systemctl restart httpd
  ```
- For Nginx: Use open source WAF modules or integrate with cloud WAF services.

---

## References

- `man httpd`, `man nginx`, `man firewall-cmd`, `man openssl`, `man docker`, `man kubectl`
- [Apache HTTP Server Docs](https://httpd.apache.org/docs/)
- [Nginx Docs](https://nginx.org/en/docs/)
- [Let’s Encrypt Certbot](https://certbot.eff.org/)
- [Terraform](https://www.terraform.io/docs/)
- [Ansible](https://docs.ansible.com/)
- [New Relic APM](https://docs.newrelic.com/docs/apm/)
- [Datadog APM](https://docs.datadoghq.com/apm/)
- [Elastic APM](https://www.elastic.co/guide/en/apm/get-started/current/overview.html)
- [Docker Docs](https://docs.docker.com/)
- [Kubernetes Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/)
- [GitHub Actions](https://docs.github.com/en/actions)
- [GitLab CI/CD](https://docs.gitlab.com/ee/ci/)
- [ModSecurity](https://modsecurity.org/)
- [AWS WAF](https://docs.aws.amazon.com/waf/latest/developerguide/)
- [Cloudflare WAF](https://developers.cloudflare.com/waf/)

---

_Best Practice:_  
Use infrastructure as code, automate everything (certificates, deployments, updates), monitor at all levels (APM, server, security), containerize for scale, protect with WAF, and integrate with CI/CD for continuous delivery. This is the modern DevOps standard for web services.

---
