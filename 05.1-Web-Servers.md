# Web Servers: Apache & Nginx, Hosting, Security, and Enterprise Enhancements

This guide covers the installation and configuration of Apache and Nginx web servers for hosting static, PHP, and Python websites, securing them with HTTPS, SSH login, and setting up Nginx as a load balancer. Includes SELinux, firewall, multi-site/virtual host scenarios, and enterprise topics for modern DevOps environments.

---

**Web Servers:**
 - A software application or a combination of hardware and software that stores, processes, and delivers web pages to users via HTTP/HTTPS.
   - Hardware: Physical machine storing server software and website files, connected to the internet.
   - Software: Applications like Apache, Nginx, and IIS that process requests and manage content delivery.
- Key Functions:
  - Storing Content, Request handling, load balancing, SSL termination, Caching, Handling Protocols
- Types:
  - Static: Serve pre-existing files (HTML, CSS, JS, images)
  - Dynamic: Process requests via applications (Python, PHP, Node.js)
    
- Popular Web Servers
  - Nginx
    - Architecture: Event-driven, asynchronous
    - Use Cases: Reverse proxy, load balancer, static content server
    - Config: /etc/nginx/nginx.conf, server blocks
    - Pros: High performance, low memory footprint

  - Apache HTTP Server
    - Architecture: Process/thread-based (MPM)
    - Use Cases: Dynamic content, .htaccess flexibility
    - Config: /etc/httpd/conf/httpd.conf, .htaccess
    - Pros: Modular (modules), extensive feature set
      
  - Other examples are - Caddy, LiteSpeed, Apache Tomcat, Microsoft IIS (Internet Information Services), Jigsaw, 
Jigsaw, Oracle iPlanet Web Server, Lighttpd, etc...


**SSH Login for Remote Server Access**
- Linux/Unix:
  - Syntax:
  ```bash
    ssh devops@<Server_IP> or <Server_hostname>
  ```

- Windows: 
- For Windows 8 and earlier:
- Download & install [MobaXterm](https://mobaxterm.mobatek.net/)  
  - Start local terminal
    
- SSH works natively on Windows 10 (build 1809 and later) and Windows 11
  - Open a terminal (Command Prompt, PowerShell, or Windows Terminal).
  - Check if SSH is installed by typing ssh; a usage message means it’s ready.
  - If not installed, go to Settings > Apps > Optional features > Add a feature and install OpenSSH Client.


  - Example:
  ```bash
  ssh devops@192.168.100.172
  ssh -p 2222 devops@server-ip      # Custom port
  ```
  

**SSH Configuration File (~/.ssh/config)**
```bash
Host webserver
    HostName 192.168.100.172
    User devops
    Port 22
    IdentityFile ~/.ssh/webserver_key

Host appserver
    HostName 192.168.100.173  
    User devops
    ProxyJump webserver  # Bastion host
```


---


**Apache HTTP Server (Apache)**

Introduction:
* Free, open-source, cross-platform web server.
* Developed by the Apache Software Foundation.
* Historically the most popular web server; now shares market with Nginx.

Key Features:
* Open source, free to use and modify, with large community support.
* Modular architecture, extended via modules such as SSL, URL rewriting, and security.
* Cross-platform, works on Linux, Windows, macOS, and Unix.
* .htaccess support allows directory-level configuration for flexible hosting.
* Robust and stable, reliable under high traffic.
* Strong security with regular updates and security modules.

How it Works:
* Listens on HTTP/HTTPS ports (80/443).
* Serves requested web pages or resources to clients.
* Uses Multi-Processing Modules (MPMs):
  * prefork: process-based, safe for non-threaded libraries.
  * worker: multi-threaded, better performance under load.

Common Uses:
* Hosting static websites (HTML, CSS, images).
* Hosting dynamic websites using PHP, Python, or Perl via modules.
* Acting as a reverse proxy or load balancer for application servers.


**A. Install & Start Apache (CentOS/RHEL/Fedora)**
```bash
rpm -q httpd                   # Check if the Apache HTTP Server package is installed

sudo yum update -y             # Update all installed packages to the latest version automatically
sudo yum install httpd -y      # Install Apache HTTP Server without prompting for confirmation

sudo systemctl start httpd     # Start the Apache HTTP Server service immediately
sudo systemctl enable httpd    # Enable Apache to start automatically at boot
sudo systemctl status httpd    # Check the status of the Apache service

httpd -v                       # Display Apache version
```

<img width="663" height="87" alt="Screenshot 2025-11-05 at 12 06 30 PM" src="https://github.com/user-attachments/assets/718733de-b209-4ab6-98ae-4aa51583eba8" />



**B. Open Firewall Ports**
```bash
sudo firewall-cmd --permanent --add-service={http,https}   # Open HTTP port (80) & HTTPS port (443) permanently

sudo firewall-cmd --reload                                # Apply the new firewall rules

sudo firewall-cmd --list-all                              # Verify active services and open ports
```

<img width="665" height="471" alt="Screenshot 2025-11-05 at 12 13 53 PM" src="https://github.com/user-attachments/assets/40e7d132-f844-4ece-b38d-f8190a72a673" />

<img width="659" height="363" alt="Screenshot 2025-11-05 at 12 19 20 PM" src="https://github.com/user-attachments/assets/7a8673aa-d79c-4a01-aa69-5b4c08a16eba" />


**C. Verify Installation**
  - Visit:
    - http://server-ip
          or
    - http://localhost
          or
    - http://127.0.0.1

<img width="805" height="575" alt="Screenshot 2025-11-05 at 12 22 18 PM" src="https://github.com/user-attachments/assets/1ee0d323-42d5-4e2e-bbea-c6a4d62cff7e" />

      
  - Check hosts: cat /etc/hosts
  
  <img width="716" height="165" alt="Screenshot 2025-11-05 at 12 20 24 PM" src="https://github.com/user-attachments/assets/71fb04f2-84e4-4261-9670-6d6a5b9a8655" />


---

**Hosting a Static Website**

**A. Directory Setup**
```bash
# Create web directory
sudo mkdir -p /var/www/html
sudo mkdir -p /var/www/html/{page1,page2}

# Set permissions
sudo chown -R apache:apache /var/www/html
sudo chmod -R 755 /var/www/html

# Verify ownership
ls -lh /var/www/
```

**B. Create Pages**
```bash
sudo vim /var/www/html/index.html
```

```bash
<!DOCTYPE html>
<html>
<head>
    <title>Static Website</title>
</head>
<body>
    <h1>This is a static website!!!</h1>
    <p><a href="/page1">Page 1</a> | <a href="/page2">Page 2</a></p>
</body>
</html>
```

**Subdirectory pages**

`sudo vim /var/www/html/page1/index.html`
```bash
<h1> Hello from the first page! </h1>
```

`sudo vim /var/www/html/page2/index.html`
```
<h1> Hello from the second page! </h1>
```

Check Syntax Error:
```
httpd -t
```

```bash
sudo systemctl restart httpd
```

**C.Test**
Visit: `http://localhost/`, `http://localhost/page1`, `http://localhost/page2`

<img width="805" height="389" alt="Screenshot 2025-11-06 at 6 55 19 AM" src="https://github.com/user-attachments/assets/6ca15a94-c969-4b3f-baa6-e20f0d0719f4" />

<img width="804" height="321" alt="Screenshot 2025-11-06 at 6 56 23 AM" src="https://github.com/user-attachments/assets/b6d14714-b4c2-4208-b8e5-10d6f2979220" />


<img width="805" height="334" alt="Screenshot 2025-11-06 at 6 56 44 AM" src="https://github.com/user-attachments/assets/068febe6-bdae-4a8a-80f5-94307eed17b7" />

---

**4. Apache Main Configuration**

- Main config file: `/etc/httpd/conf/httpd.conf`
- Key directives to check
  
```bash
DocumentRoot "/var/www/html"   # Directory where website files are served from
ServerRoot "/etc/httpd"        # Location of the Apache server’s configuration files
Listen 80                      # Apache listens for incoming connections on port 80
```
  
<img width="662" height="469" alt="Screenshot 2025-11-06 at 6 58 43 AM" src="https://github.com/user-attachments/assets/8bb4e908-cf91-4f46-b60c-2c6da80ff26f" />


---


**5. Virtual Host**:
 - A Virtual Host is a method for hosting multiple websites (with separate domain names) on a single Apache server. Instead of requiring multiple physical machines, Apache uses the requested domain name or IP address to determine which website's content to serve.
  - IP-based Virtual Hosts
    - Different websites use different IP addresses on the same server.
 
  - Name-based Virtual Hosts
    - Different websites share the same IP address, and Apache distinguishes them by the domain name in the Host: HTTP header. This is the most common method.

  
**Virtual Host Configuration**:
  - Syntax and Directives
```bash
<VirtualHost [IP_Address]:[Port]>                     # Defines a virtual host for a specific IP and port
    ServerName www.example.com                         # Primary domain handled by this virtual host
    ServerAlias example.com *.example.org              # Alternate domains served by the same configuration
    ServerAdmin webmaster@example.com                  # Contact email for the server administrator
    DocumentRoot /var/www/example.com/html             # Directory containing the website’s files

    <Directory /var/www/example.com/html>              # Applies settings to the DocumentRoot directory
        AllowOverride All                              # Enables use of .htaccess files
        Require all granted                             # Allows all clients to access the site
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/example.com_error.log             # File to store error messages for this site
    CustomLog ${APACHE_LOG_DIR}/example.com_access.log combined  # File and format for access logs
</VirtualHost>                                                   # End of virtual host definition
``` 


**Example 1:**
   - Let's create a virtual host for myapp.com.np
   
   - Create the Directory Structure
```bash
sudo mkdir -p /var/www/myapp.com.np
```

   - Assign Ownership and Permissions
```bash
sudo chown -R $USER:$USER /var/www/myapp.com.np
sudo chmod -R 755 /var/www/myapp.com.np
```

 - Create a Sample index.html File
```bash
sudo vim /var/www/myapp.com.np/index.html
```
 - Add content
 ```html
<html>
  <head>
    <title>Welcome to MyApp!</title>
  </head>
  <body>
    <h1>Success! The myapp.com.np virtual host is working!</h1>
  </body>
</html>
```

   - Create the Virtual Host File 
 ```bash
 sudo nano /etc/apache2/sites-available/myapp.com.np.conf       #Debian/Ubuntu
 
 sudo vim /etc/httpd/conf.d/myapp.com.np.conf                   #RedHat/CentOS/Fedora
 ```
 
   - Edit DocumentRoot file: `sudo vim /etc/httpd/conf/httpd.conf`
<img width="787" height="474" alt="Screenshot 2025-11-06 at 12 21 16 PM" src="https://github.com/user-attachments/assets/7a3fb938-e204-4354-9237-79aa4232daf9" />

   
   - Add the following configuration:
 ```apache
<VirtualHost *:80>                                             # Virtual host listening on port 80 (HTTP)
    ServerName myapp.com.np                                    # Primary domain name for this website
    ServerAlias www.myapp.com.np                               # Additional domain name pointing to the same site
    DocumentRoot /var/www/myapp.com.np                         # Directory where the website files are stored
    ErrorLog /var/log/httpd/myapp.com.np_error.log             # File where Apache logs errors for this site
    CustomLog /var/log/httpd/myapp.com.np_access.log combined  # File and format for access logs

    # Directory settings
    <Directory "/var/www/html/myapp.com.np">               # Configuration for this site’s root directory
        Options Indexes FollowSymLinks                     # Enables directory listing and symbolic links
        AllowOverride All                                  # Allows use of .htaccess files for overrides
        Require all granted                                # Grants access to all clients
    </Directory>
</VirtualHost>                                             # End of virtual host configuration
 ```
<img width="528" height="471" alt="Screenshot 2025-11-06 at 12 17 40 PM" src="https://github.com/user-attachments/assets/4321cfc7-8d18-466f-96d6-2291d185939e" />

 ```bash
  httpd -t                         #Check Syntax
  sudo httpd -S                    #Show vhosts
 ```
<img width="1022" height="109" alt="Screenshot 2025-11-06 at 12 18 05 PM" src="https://github.com/user-attachments/assets/31e90c18-fe95-48e5-86d6-643c61ae5fca" />

 - Reload HTTPD Service
```
systemctl restart httpd
```
 - Test the page

![Screenshot 2025-11-06 at 12 24 54 PM](https://github.com/user-attachments/assets/4a2da4b6-4b87-430f-b026-b762b1f8a03a)


**Example 2: Multiple Websites with Virtual Hosts**

- Directory Structure
```bash
# Create directories for multiple sites
sudo mkdir -p /var/www/example1.com
sudo mkdir -p /var/www/example2.com

# Set permissions
sudo chown -R apache:apache /var/www/example1.com
sudo chown -R apache:apache /var/www/example2.com
sudo chmod -R 755 /var/www
```

- Create sample web pages
   `sudo vim /var/www/example1.com/index.html`
```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>example1.com — It works!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
    .card {
      max-width: 720px; margin: 0 auto; padding: 2rem;
      border-radius: 12px; border: 1px solid #d0d7de;
    }
    h1 { margin: 0 0 .5rem; }
    code { background: rgba(127,127,127,.15); padding: .2rem .4rem; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>It works! example1.com</h1>
    <p>You are seeing the site served from <code>/var/www/example1.com</code>.</p>
    <p>ServerName: <strong>example1.com</strong></p>
    <p>If this is not the site you expected, check your VirtualHost <code>DocumentRoot</code> and <code>ServerName</code> settings.</p>
  </div>
</body>
</html>
```

   `sudo vim /var/www/example2.com/index.html`
```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>example2.com — It works!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
    .card {
      max-width: 720px; margin: 0 auto; padding: 2rem;
      border-radius: 12px; border: 1px solid #d0d7de;
    }
    h1 { margin: 0 0 .5rem; }
    code { background: rgba(127,127,127,.15); padding: .2rem .4rem; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>It works! example2.com</h1>
    <p>You are seeing the site served from <code>/var/www/example2.com</code>.</p>
    <p>ServerName: <strong>example2.com</strong></p>
    <p>If this is not the site you expected, check your VirtualHost <code>DocumentRoot</code> and <code>ServerName</code> settings.</p>
  </div>
</body>
</html>
```

- Virtual Host Configurations
  `sudo vim /etc/httpd/conf.d/example1.com.conf`
```apache
<VirtualHost *:80>
    ServerAdmin admin@example1.com
    ServerName example1.com
    ServerAlias www.example1.com
    DocumentRoot /var/www/example1.com

    ErrorLog /var/log/httpd/example1_error.log
    CustomLog /var/log/httpd/example1_access.log combined

    <Directory "/var/www/example1.com">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

 `sudo vim /etc/httpd/conf.d/example2.com.conf`
```apache
<VirtualHost *:80>
    ServerAdmin admin@example2.com
    ServerName example2.com
    ServerAlias www.example2.com
    DocumentRoot /var/www/example2.com

    ErrorLog /var/log/httpd/example2_error.log
    CustomLog /var/log/httpd/example2_access.log combined

    <Directory "/var/www/example2.com">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```
  
```bash
sudo apachectl configtest
sudo systemctl restart httpd
```

 - Local Testing Setup
   - Edit `sudo vim /etc/hosts` on your local machine:
```text
192.168.100.172 example1.com
192.168.100.172 example2.com
192.168.100.172 www.example1.com
192.168.100.172 www.example2.com
```

 - On your browser
   - http://www.example1.com/
<img width="794" height="371" alt="Screenshot 2025-11-06 at 12 52 46 PM" src="https://github.com/user-attachments/assets/19eac9b3-6617-436b-a96e-726ee89ade0e" />


   - http://www.example2.com/
<img width="803" height="379" alt="Screenshot 2025-11-06 at 12 53 33 PM" src="https://github.com/user-attachments/assets/edcdfe83-4260-45f4-9bb4-cb56a85ec6ea" />


---


**6. Hosting PHP Websites**

Apache supports two primary methods for processing PHP:

- mod_php (Traditional)
  - PHP runs as an Apache module
  - Simpler setup, but less flexible
  - All Apache child processes load PHP, consuming more memory

- PHP-FPM (FastCGI Process Manager) (Recommended)
  - PHP runs as a separate process
  - Better performance, especially for high-traffic sites
  - More secure and resource-efficient
  - Supports different PHP versions for different sites


**A. Install PHP and Dependencies**

 - For RHEL/CentOS/Fedora:
```bash
sudo dnf install php php-fpm php-mysqlnd php-json php-xml php-mbstring -y  # Install PHP and common PHP modules
sudo dnf install php php-cli php-common -y                                 # Install Apache PHP module (mod_php) components

sudo systemctl start php-fpm                                               # Start PHP-FPM service
sudo systemctl enable php-fpm                                              # Enable PHP-FPM to start at boot
sudo systemctl status php-fpm                                              # Check PHP-FPM service status

php -v                                                                     # Display PHP version
```

**B. Configure Firewall**
```bash
# Open HTTP and HTTPS ports
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload

# Alternative: Open specific ports
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload
```

**C. Virtual Host Configuration**

 - `sudo vim /etc/httpd/conf.d/phpwebsite.conf`

- Method 1: Using PHP-FPM (Recommended)
```apache
<VirtualHost *:80>
    ServerAdmin admin@phpwebsite.local
    ServerName phpwebsite.local
    DocumentRoot /var/www/phpwebsite
    
    # PHP handling via PHP-FPM with ProxyFCGI
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"
    </FilesMatch>
    
    # Alternative syntax for some distributions
    # <FilesMatch \.php$>
    #    SetHandler "proxy:fcgi://127.0.0.1:9000"
    # </FilesMatch>
    
    <Directory "/var/www/phpwebsite">
        Options -Indexes +FollowSymLinks +MultiViews
        AllowOverride All
        Require all granted
        
        # Security headers
        Header always set X-Content-Type-Options nosniff
        Header always set X-Frame-Options DENY
    </Directory>
    
    # Log configuration
    ErrorLog /var/log/httpd/phpwebsite_error.log
    CustomLog /var/log/httpd/phpwebsite_access.log combined
    LogLevel warn
</VirtualHost>
```

- Method 2: Using mod_php (Traditional)
```apache
<VirtualHost *:80>
    ServerAdmin admin@phpwebsite.local
    ServerName phpwebsite.local
    DocumentRoot /var/www/phpwebsite
    
    # With mod_php, PHP processing is automatic
    # Ensure mod_php is loaded: LoadModule php_module modules/libphp.so
    
    <Directory "/var/www/phpwebsite">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog /var/log/httpd/phpwebsite_error.log
    CustomLog /var/log/httpd/phpwebsite_access.log combined
</VirtualHost>
```

**D. Directory Structure and Permissions**
```bash
sudo mkdir -p /var/www/phpwebsite
```

```bash
sudo vim /var/www/phpwebsite/index.php
```
```php
<?php
// Basic PHP info page
phpinfo();

// Display server information
echo "<h3>Server Environment:</h3>";
echo "Server Name: " . $_SERVER['SERVER_NAME'] . "<br>";
echo "Document Root: " . $_SERVER['DOCUMENT_ROOT'] . "<br>";
?>
EOF
```

```bash
sudo chown -R apache:apache /var/www/phpwebsite              # Set Apache as the owner and group for the website directory
sudo chmod -R 755 /var/www/phpwebsite                        # Give owner full access, others read and execute permissions for directories
sudo find /var/www/phpwebsite -type f -exec chmod 644 {} \;  # Set file permissions to read/write for owner and read-only for others
```
  
**E. Final Configuration and Testing**
```bash
sudo httpd -t                                 # Test Apache configuration syntax for errors


sudo systemctl restart php-fpm                # Restart PHP-FPM service to apply changes
sudo systemctl restart httpd                  # Restart Apache service


sudo systemctl enable php-fpm                 # Enable PHP-FPM to start automatically at boot
sudo systemctl enable httpd                   # Enable Apache to start automatically at boot

sudo systemctl status php-fpm                 # Check current status of PHP-FPM service
sudo systemctl status httpd                   # Check current status of Apache service
```

Test: `http://127.0.0.1/`
<img width="994" height="693" alt="Screenshot 2025-11-07 at 7 03 20 AM" src="https://github.com/user-attachments/assets/a0311338-1f86-4c01-813c-0447160c115d" />

---

**7. Hosting Python Websites (mod_wsgi)**

- Installation and Setup
  - Install Apache, Python, mod_wsgi
  
```bash
# For RHEL/CentOS/Fedora:
sudo dnf install httpd python3 python3-mod_wsgi -y

# Start and enable Apache
sudo systemctl start httpd
sudo systemctl enable httpd

# Verify mod_wsgi installation
sudo httpd -M | grep wsgi
```

 - Configure Firewall
```bash
# Open HTTP and HTTPS ports
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload

# Alternative: Open specific ports
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload
```

 - Directory Structure and Application Setup
   - Create Project Directory and WSGI Application
   
```bash
# Create project directory
sudo mkdir -p /var/www/python
```
```bash
# Create WSGI application file
sudo vim /var/www/python/myweb.wsgi
```

```python
#!/usr/bin/python3
import sys

# Add your application's directory to Python path
sys.path.insert(0, '/var/www/python')

def application(environ, start_response):
    # Set response headers
    status = '200 OK'
    response_headers = [('Content-type', 'text/html; charset=utf-8')]
    start_response(status, response_headers)
    
    # HTML response
    html = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>Python WSGI App</title>
    </head>
    <body>
        <h1>Hello from Python WSGI!</h1>
        <p>This is a Python web application running on Apache with mod_wsgi.</p>
        <h3>Server Information:</h3>
        <ul>
            <li>Python Version: {version}</li>
            <li>Server Software: {software}</li>
            <li>Request Method: {method}</li>
        </ul>
    </body>
    </html>
    """.format(
        version=sys.version.split()[0],
        software=environ.get('SERVER_SOFTWARE', 'Unknown'),
        method=environ.get('REQUEST_METHOD', 'GET')
    )
    
    return [html.encode('utf-8')]
```

 - Set Proper Permissions
```bash
# Set ownership to Apache user
sudo chown -R apache:apache /var/www/python

# Set appropriate permissions
sudo chmod -R 755 /var/www/python
sudo chmod 644 /var/www/python/*.wsgi
sudo chmod 644 /var/www/python/*.py

# For RHEL/CentOS/Fedora, the Apache user is typically 'apache'
# For Debian/Ubuntu, the Apache user is typically 'www-data'
```

 - Virtual Host Configuration
   `sudo vim /etc/httpd/conf.d/python.conf`
```apache
<VirtualHost *:80>
    ServerAdmin admin@python.local
    ServerName python.local
    ServerAlias www.python.local
    
    # Document root for static files
    DocumentRoot /var/www/python
    
    # WSGI configuration
    WSGIDaemonProcess python-app user=apache group=apache threads=5
    WSGIScriptAlias / /var/www/python/myweb.wsgi
    
    # Directory configuration for WSGI script
    <Directory /var/www/python>
        WSGIProcessGroup python-app
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
        Options -Indexes +FollowSymLinks
        
        # Allow .htaccess overrides
        AllowOverride All
    </Directory>
    
    # Static files handling (optional)
    Alias /static /var/www/python/static
    <Directory /var/www/python/static>
        Require all granted
    </Directory>
    
    # Log files
    ErrorLog /var/log/httpd/python_error.log
    CustomLog /var/log/httpd/python_access.log combined
    LogLevel warn
</VirtualHost>
```

 - Final Steps and Testing
```bash
# Test Apache configuration
sudo apachectl configtest

# If using SELinux (RHEL/CentOS/Fedora)
sudo setsebool -P httpd_execmem 1
sudo chcon -R -t httpd_sys_content_t /var/www/python

# Restart Apache
sudo systemctl restart httpd

# Check status
sudo systemctl status httpd
```

Test the application: `http://127.0.0.1/` or `http://localhost/`

---

## 8. Hosting a Secure Site (HTTPS/SSL with Apache)

### A. Install SSL Packages
```bash
rpm -q httpd mod_ssl openssl
dnf -y install mod_ssl openssl httpd
```
### B. Firewall
```bash
firewall-cmd --list-all
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
firewall-cmd --list-all
```
### C. SSL Configuration
Edit `/etc/httpd/conf.d/ssl.conf`:
```
SSLCertificateFile /etc/pki/tls/certs/localhost.crt
SSLCertificateKeyFile /etc/pki/tsl/private/localhost.key
```
### D. Self-signed Certificate
```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -out /etc/pki/tls/certs/localhost.crt -keyout /etc/pki/tls/private/localhost.key
```
### E. DocumentRoot/Permissions
```bash
sudo mkdir -p /var/www/devopsclass
sudo chown apache:apache /var/www/devopsclass
sudo chmod 755 /var/www/devopsclass
cd /var/www/devopsclass
vim index.html
# <h1> testing secure site!! </h1>
```
### F. Virtual Host for HTTPS
`/etc/httpd/conf.d/devopsclass.conf`:
```
<VirtualHost *:443>
    ServerName www.devopsclass.com
    DocumentRoot /var/www/devopsclass
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
</VirtualHost>
```
### G. Restart & Test
```bash
httpd -t
systemctl restart httpd
```
Test: `https://127.0.0.1/`  
(Proceed past the browser warning for self-signed certificate)

---

## 9. Nginx Web Server Setup

### A. Remove/Stop Apache (if needed)
```bash
dnf -y remove httpd
systemctl stop httpd
systemctl disable httpd
```
### B. Install & Start Nginx
```bash
dnf -y install nginx
systemctl start nginx
systemctl enable nginx
```
### C. Firewall
```bash
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```
### D. Default Page & Config
```bash
cd /usr/share/nginx/html
sudo mkdir devops
cd devops
sudo vim index.html
# <h1> Testing nginx Web Server </h1>
cd /etc/nginx/conf.d
sudo vim devops.conf
# server {
#   listen 80;
#   server_name 192.168.64.4; # or www.devops.com
#   root /usr/share/nginx/html/devops;
#   index index.html;
# }
sudo nginx -t
sudo systemctl restart nginx
```
Test: `http://127.0.0.1/`

---

## 10. Load Balancer Setup Using Nginx

### A. Architecture
- 3 VMs: Load Balancer (192.168.64.5), Node 1 (192.168.64.6), Node 2 (192.168.64.7)

### B. Configure Load Balancer
```bash
hostnamectl set-hostname loadbalancer
dnf -y install nginx
systemctl start nginx
systemctl enable nginx
firewall-cmd --permanent --add-service=http
firewall-cmd --reload
cd /etc/nginx/conf.d
sudo vim loadbalance.conf
```
```
upstream backend_servers {
    server 192.168.64.6;
    server 192.168.64.7;
}
server {
    listen 80;
    server_name 192.168.64.5;
    location / {
        proxy_pass http://backend_servers;
    }
}
```
Test & restart:
```bash
sudo nginx -t
sudo systemctl restart nginx
```

### C. Configure Backend Servers (Node 1 & Node 2)
- Install & start nginx, open firewall, create `devops/index.html` in `/usr/share/nginx/html`
- Node1: `server_name 10.10.5.6`
- Node2: `server_name 10.10.5.7`
- Update `/etc/nginx/conf.d/node1.conf` and `/etc/nginx/conf.d/node2.conf` for each node.

---

## 11. SELinux and Security

- Check SELinux status:
  ```bash
  getenforce
  ```
- View logs:
  ```bash
  sudo cat /var/log/audit/audit.log | grep nginx
  ```
- List and set booleans:
  ```bash
  getsebool -a
  getsebool -a | grep network
  setsebool -P httpd_can_network_connect=1
  getsebool -a | grep httpd_can_network_connect
  ```

---

## 12. Ultra-Enterprise Enhancements

### A. Advanced Application-Level Monitoring (APM)
- Integrate tools like **New Relic**, **Datadog APM**, **Elastic APM** for real-time web transaction tracing, error detection, and performance analytics.
- Instrument web apps for latency, throughput, slow queries, distributed tracing, and user experience.

### B. Automated Certificate Management (Let's Encrypt, Certbot)
- Use **Certbot** for free SSL/TLS certificates and auto-renewal:
  ```bash
  sudo dnf install certbot python3-certbot-apache
  sudo certbot --apache
  # For Nginx:
  sudo dnf install certbot python3-certbot-nginx
  sudo certbot --nginx
  # Schedule renewal:
  echo "0 0 * * * certbot renew --quiet" | sudo tee /etc/cron.d/certbot-renew
  ```
- Integrate certificate lifecycle management with monitoring and alerting.

### C. Infrastructure as Code (IaC)
- Use **Terraform** and **Ansible** for automated, repeatable deployments of web servers, load balancers, firewalls, certificates, and DNS.
- Example: Terraform for AWS EC2 + Ansible for Apache setup.
- Store configurations in version control and integrate with CI/CD for automated provisioning and rollback.

### D. Containerized Web Servers (Docker, Kubernetes Ingress)
- Deploy web servers as Docker containers for portability and scalability:
  - Example:  
    ```bash
    docker run -d -p 80:80 --name webserver -v /site:/usr/share/nginx/html nginx
    ```
- Use **Kubernetes** with **Ingress controllers** for scalable, self-healing deployments, SSL termination, and advanced routing.
- Define web apps and load balancers in YAML manifests and manage with `kubectl`.

### E. CI/CD Integration for Automated Updates
- Connect GitHub/GitLab CI/CD pipelines to build, test, and deploy web server updates automatically.
- Example:  
  - Push to main branch triggers Ansible playbook or Docker build/deploy.
  - Use pipeline stages for syntax check (`nginx -t`, `httpd -t`), unit/integration tests, and production rollout.

### F. Web Application Firewall (WAF) Configuration
- Deploy WAFs (e.g., **ModSecurity** for Apache/Nginx, AWS WAF, Cloudflare WAF) to block attacks (SQL injection, XSS, etc).
- Configure security rules, monitor logs, and integrate with SIEM for threat detection.
- Example for ModSecurity with Apache:
  ```bash
  sudo dnf install mod_security
  sudo systemctl restart httpd
  ```
- For Nginx: Use open source WAF modules or integrate with cloud WAF services.

---

## References

- `man httpd`, `man nginx`, `man firewall-cmd`, `man openssl`, `man docker`, `man kubectl`
- [Apache HTTP Server Docs](https://httpd.apache.org/docs/)
- [Nginx Docs](https://nginx.org/en/docs/)
- [Let’s Encrypt Certbot](https://certbot.eff.org/)
- [Terraform](https://www.terraform.io/docs/)
- [Ansible](https://docs.ansible.com/)
- [New Relic APM](https://docs.newrelic.com/docs/apm/)
- [Datadog APM](https://docs.datadoghq.com/apm/)
- [Elastic APM](https://www.elastic.co/guide/en/apm/get-started/current/overview.html)
- [Docker Docs](https://docs.docker.com/)
- [Kubernetes Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/)
- [GitHub Actions](https://docs.github.com/en/actions)
- [GitLab CI/CD](https://docs.gitlab.com/ee/ci/)
- [ModSecurity](https://modsecurity.org/)
- [AWS WAF](https://docs.aws.amazon.com/waf/latest/developerguide/)
- [Cloudflare WAF](https://developers.cloudflare.com/waf/)

---

_Best Practice:_  
Use infrastructure as code, automate everything (certificates, deployments, updates), monitor at all levels (APM, server, security), containerize for scale, protect with WAF, and integrate with CI/CD for continuous delivery. This is the modern DevOps standard for web services.

---
